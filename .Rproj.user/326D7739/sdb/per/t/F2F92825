{
    "collab_server" : "",
    "contents" : "#Author: Sarah P. Flanagan\n#Last updated: 23 September 2016\n#Date Started: 24 February 2016\n#Purpose: compare RAD libraries prepared by two different methods\n\nrm(list=ls())\nlibrary(ggplot2)\nsetwd(\"~/Projects/SCA/results\")\nsource(\"../scripts/plotting_functions.R\")\nboth<-parse.vcf(\"stacks_both/batch_3.vcf\")\n#################FUNCTIONS####################\nparse.vcf<-function(filename){\n  vcf<-read.delim(filename,comment.char=\"#\",sep='\\t',header=F,stringsAsFactors = F)\n  header.start<-grep(\"#CHROM\",scan(filename,what=\"character\"))\n  header<-scan(filename,what=\"character\")[header.start:(header.start+ncol(vcf)-1)]\n  colnames(vcf)<-header\n  return(vcf)\n}\n\nvcf.cov.loc<-function(vcf.row,subset){\n  cov<-unlist(lapply(vcf.row[subset],function(x){ \n    c<-strsplit(as.character(x),split=\":\")[[1]][3]\n    return(c)\n  }))\n  miss<-length(cov[cov==\".,.\"])\n  pres<-length(cov[cov!=\".,.\"])\n  ref<-sum(as.numeric(unlist(lapply(cov[cov!=\".,.\"],\n                                    function(x){\n                                      strsplit(as.character(x),\",\")[[1]][1] \n                                    }))))/pres\n  alt<-sum(as.numeric(unlist(lapply(cov[cov!=\".,.\"],\n                                    function(x){\n                                      strsplit(as.character(x),\",\")[[1]][2] \n                                    }))))/pres\n  tot<-sum(as.numeric(unlist(lapply(cov[cov!=\".,.\"],\n                                    function(x){\n                                      as.numeric(strsplit(as.character(x),\",\")[[1]][1]) + \n                                        as.numeric(strsplit(as.character(x),\",\")[[1]][2])\n                                    }))))\n  var.cov<-var(as.numeric(unlist(lapply(cov[cov!=\".,.\"],\n                                        function(x){\n                                          as.numeric(strsplit(as.character(x),\",\")[[1]][1]) + \n                                            as.numeric(strsplit(as.character(x),\",\")[[1]][2])\n                                        }))))\n  het<-unlist(lapply(vcf.row[subset],function(x){ \n    strsplit(as.character(x),split=\":\")[[1]][1]\n  }))\n  het<-length(het[het==\"0/1\" | het==\"1/0\"])\n  return(data.frame(Chrom=vcf.row[1],Pos=vcf.row[\"POS\"],Locus=vcf.row[\"ID\"],\n                    NumMissing=miss, NumPresent=pres,PropMissing=miss/(miss+pres),\n                    AvgCovRef=ref,AvgCovAlt=alt, AvgCovRatio=ref/alt,AvgCovTotal=tot/pres, CovVariance=var.cov,\n                    NumHet=het,PropHet=het/pres,TotalNumReads = tot,stringsAsFactors = F))\n}\n\nvcf.cov.ind<-function(vcf.col){\n  cov<-unlist(lapply(vcf.col,function(x){ \n    c<-strsplit(as.character(x),split=\":\")[[1]][3]\n    return(c)\n  }))\n  miss<-length(cov[cov==\".,.\"])\n  pres<-length(cov[cov!=\".,.\"])\n  ref<-sum(as.numeric(unlist(lapply(cov[cov!=\".,.\"],\n                                    function(x){\n                                      strsplit(as.character(x),\",\")[[1]][1] \n                                    }))))/pres\n  alt<-sum(as.numeric(unlist(lapply(cov[cov!=\".,.\"],\n                                    function(x){\n                                      strsplit(as.character(x),\",\")[[1]][2] \n                                    }))))/pres\n  tot<-sum(as.numeric(unlist(lapply(cov[cov!=\".,.\"],\n                                    function(x){\n                                      as.numeric(strsplit(as.character(x),\",\")[[1]][1]) + \n                                        as.numeric(strsplit(as.character(x),\",\")[[1]][2])\n                                    }))))/pres\n  het<-unlist(lapply(vcf.col,function(x){ \n    strsplit(as.character(x),split=\":\")[[1]][1]\n  }))\n  het<-length(het[het==\"0/1\" | het==\"1/0\"])\n  return(list(NumMissing=miss,NumPresent=pres,AvgCovRef=ref,AvgCovAlt=alt,AvgCovTot=tot,PropHet=het/pres, NumReads=tot*pres))\n}\n\nfst.two.vcf<-function(vcf1.row,vcf2,match.index, cov.thresh=0.2){\n  #match.index is the column used to match the two\n  #use in conjunction with apply\n  #e.g. apply(vcf,1,fst.two.vcf,vcf2=vcf.2,match.index=\"SNP\")\n  hs1<-hs2<-hs<-ht<-0\n  freqall<-gt1<-gt2<-NULL\n  vcf2.row<-vcf2[vcf2[,match.index]%in%vcf1.row[match.index],]\n  if(nrow(vcf2.row)>1)#first make sure we have one reading per locus\n  {\n    print(\"Multiple instances in vcf2.\")\n    fst<-NA\n  }\n  else{\n    if(nrow(vcf2.row)==0)\n    {\n      print(\"No instances in vcf2.\")\n      fst<-NA\n    }else #we're good to go\n    {\n      al1<-vcf.alleles(vcf1.row)\n      al2<-vcf.alleles(vcf2.row)\n      if((length(al1)/2)/(length(vcf1.row)-10)>=cov.thresh & (length(al2)/2)/(ncol(vcf2.row)-10)>=cov.thresh){\n        #calculate frequencies\n        fst<-calc.fst.wright(al1,al2)\n      }else {\n        # print(paste(vcf.row[\"#CHROM\"],vcf.row[\"POS\"],\"fails cov thresh\"),sep=\" \")\n        fst<-data.frame(Hs1=NA,Hs2=NA,Hs=NA,Ht=NA,Fst=NA,NumAlleles=length(factor(c(al1,al2))),\n                        Num1=length(al1),Num2=length(al2)) #it doesn't pass the coverage threshold\n      }\n    }#good to go\n  }\n  return(data.frame(Chrom=vcf1.row[\"#CHROM\"],Pos=vcf1.row[\"POS\"],\n                    Hs1=fst[\"Hs1\"],Hs2=fst[\"Hs2\"],Hs=fst[\"Hs\"],Ht=fst[\"Ht\"],Fst=as.numeric(fst[\"Fst\"]),NumAlleles=fst[\"NumAlleles\"],\n                    Num1=fst[\"Num1\"],Num2=fst[\"Num2\"],stringsAsFactors=FALSE))\n}#end function\n\nvcf.alleles<-function(vcf.row){\n  gt1<-unlist(lapply(vcf.row,function(x){ \n    c<-strsplit(as.character(x),split=\":\")[[1]][1]\n    return(c)\n  }))\n  gt1<-gt1[gt1 %in% c(\"0/0\",\"1/0\",\"0/1\",\"1/1\")]\n  gt1[gt1%in%\"1/0\"]<-\"0/1\"\n  gt1<-gsub(pattern = \"0\",replacement = vcf.row[\"REF\"],gt1)\n  gt1<-gsub(pattern = \"1\",replacement = vcf.row[\"ALT\"],gt1)\n  al1<-unlist(strsplit(as.character(gt1),split = \"/\"))\n  return(al1)\n}\n\ncalc.fst.nei<-function(al1,al2){\n  hw<-hb<-fst<-0\n  freq1<-summary(factor(al1))/sum(summary(factor(al1)))\t\n  freq2<-summary(factor(al2))/sum(summary(factor(al2)))\t\n  al12<-c(al1,al2)\n  freqall<-summary(as.factor(al12))/\n    sum(summary(as.factor(al12)))\n  if(length(freq1)>1 & length(freq2)>1){ #both must be polymorphic\n    hs1<-1-sum(freq1*freq1)\n    hs2<-1-sum(freq2*freq2)\n    hw<-sum(hs1,hs2)\n    hb<-1-sum(freqall*freqall)\n    fst<-1-(hw/(2*hb))\n  } else {\n    hs1<-1-sum(freq1*freq1)\n    hs2<-1-sum(freq2*freq2)\n    if(length(freqall)<=1){ \n      hw<-1\n      fst<-NA\n    } else{ \n      hw<-1-sum(freqall*freqall)\n      fst<-NA\n    }\n  }\n  return(data.frame(Hs1=hs1,Hs2=hs2,Hs=hb,Ht=hw,Fst=as.numeric(fst),NumAlleles=length(factor(freqall)),\n                    Num1=length(al1),Num2=length(al2)))\n}\n\n\ncalc.fst.wright<-function(al1,al2){\n  hs<-ht<-fst<-0\n  freq1<-summary(factor(al1))/sum(summary(factor(al1)))\t\n  freq2<-summary(factor(al2))/sum(summary(factor(al2)))\t\n  al12<-c(al1,al2)\n  freqall<-summary(as.factor(al12))/\n    sum(summary(as.factor(al12)))\n  if(length(freq1)>1 & length(freq2)>1){ #both must be polymorphic\n    hs1<-1-sum(freq1*freq1)\n    hs2<-1-sum(freq2*freq2)\n    hs<-(hs1*length(al1)+hs2*length(al2))/(length(al1)+length(al2))\n    ht<-1-sum(freqall*freqall)\n    fst<-(ht-hs)/ht\n  } else {\n    hs1<-1-sum(freq1*freq1)\n    hs2<-1-sum(freq2*freq2)\n    if(length(freqall)<=1){ \n      ht<-1\n      fst<-NA\n    } else{ \n      ht<-1-sum(freqall*freqall)\n      fst<-NA\n    }\n  }\n  return(data.frame(Hs1=hs1,Hs2=hs2,Hs=hs,Ht=ht,Fst=as.numeric(fst),NumAlleles=length(factor(freqall)),\n                    Num1=length(al1),Num2=length(al2)))\n}\n\nfst.one.vcf<-function(vcf.row,group1,group2, cov.thresh=0.2){\n  al1<-vcf.alleles(vcf.row[group1])\n  al2<-vcf.alleles(vcf.row[group2])\n  if(((length(al2)/2)/(length(group2)-10))>=cov.thresh & ((length(al1)/2)/(length(group1)-10))>=cov.thresh){\n    # print(paste(vcf.row[\"#CHROM\"],vcf.row[\"POS\"],\"passes cov thresh\"),sep=\" \")\n    fst<-calc.fst.wright(al1,al2)\n  }else {\n    # print(paste(vcf.row[\"#CHROM\"],vcf.row[\"POS\"],\"fails cov thresh\"),sep=\" \")\n    fst<-data.frame(Hs1=NA,Hs2=NA,Hs=NA,Ht=NA,Fst=NA,NumAlleles=length(summary(factor(c(al1,al2)))),\n                    Num1=length(al1),Num2=length(al2)) #it doesn't pass the coverage threshold\n  }\n  \n  return(data.frame(Chrom=vcf.row[\"#CHROM\"],Pos=vcf.row[\"POS\"],\n                    Hs1=fst[\"Hs1\"],Hs2=fst[\"Hs2\"],Hs=fst[\"Hs\"],Ht=fst[\"Ht\"],Fst=as.numeric(fst[\"Fst\"]),NumAlleles=fst[\"NumAlleles\"],\n                    Num1=fst[\"Num1\"],Num2=fst[\"Num2\"],stringsAsFactors=FALSE))\n  \n  return(fst)\n}\n#fsts.both<-do.call(\"rbind\",apply(both.sub,1,fst.one.vcf,group1=c(locus.info,o.ind),group2=c(locus.info,d.ind),cov.thresh=0.5))\n\ncalc.afs.vcf<-function(vcf.row){\n  #use in conjunction with apply\n  #e.g. apply(vcf,1,afs.vcf)\n  al1<-vcf.alleles(vcf.row)\n  #calculate frequencies\n  freq1<-summary(factor(al1))/sum(summary(factor(al1)))\t\n  if(length(freq1)==1)\n  {\n    if(names(freq1)==vcf.row[\"REF\"])\n    {\n      freq1<-c(freq1,0)\n      names(freq1)<-unlist(c(vcf.row[\"REF\"],vcf.row[\"ALT\"]))\n    }\n    else\n    {\n      freq1<-c(freq1,0)\n      names(freq1)<-unlist(c(vcf.row[\"ALT\"],vcf.row[\"REF\"]))\n    }\n  }\n  return(data.frame(Chrom=vcf.row[\"#CHROM\"], Pos=vcf.row[\"POS\"], Ref=vcf.row[\"REF\"],\n                    RefFreq=freq1[names(freq1) %in% vcf.row[\"REF\"]],\n                    Alt=vcf.row[\"ALT\"],AltFreq=freq1[names(freq1) %in% vcf.row[\"ALT\"]]))\n}\n\n#fst.one.vcf<-function(vcf.row,group1,group2, cov.thresh=0.2){\n#  hs1<-hs2<-hs<-ht<-0\n#  freqall<-gt1<-gt2<-NULL\n#  al1<-vcf.alleles(vcf.row[group1])\n#  gt1<-unlist(lapply(vcf.row[group1],function(x){ \n#    c<-strsplit(as.character(x),split=\":\")[[1]][1]\n#    return(c)\n#  }))\n#  num.ind<-length(gt1)\n#  gt1<-gt1[gt1 %in% c(\"0/0\",\"1/0\",\"0/1\",\"1/1\")]\n#  gt1[gt1==\"1/0\"]<-\"0/1\"\n#  gt1<-gsub(pattern = \"0\",replacement = vcf.row[\"REF\"],gt1)\n#  gt1<-gsub(pattern = \"1\",replacement = vcf.row[\"ALT\"],gt1)\n#  if(length(gt1)/num.ind>=cov.thresh){\n#    al1<-unlist(strsplit(as.character(gt1),split = \"/\"))\n#    gt2<-unlist(lapply(vcf.row[group2],function(x){ \n#      c<-strsplit(as.character(x),split=\":\")[[1]][1]\n#      return(c)\n#    }))\n#    num.ind<-length(gt2)\n#    gt2<-gt2[gt2 %in% c(\"0/0\",\"1/0\",\"0/1\",\"1/1\")]\n#    gt2[gt2==\"1/0\"]<-\"0/1\"\n#    gt2<-gsub(pattern = \"0\",replacement = vcf.row[\"REF\"],gt2)\n#    gt2<-gsub(pattern = \"1\",replacement = vcf.row[\"ALT\"],gt2)\n#    if(length(gt2)/num.ind>=cov.thresh){\n#      al2<-unlist(strsplit(as.character(gt2),split=\"/\"))\n#      #calculate frequencies\n#      freq1<-summary(factor(al1))/sum(summary(factor(al1)))\t\n#      freq2<-summary(factor(al2))/sum(summary(factor(al2)))\t\n#      freqall<-summary(as.factor(c(al1,al2)))/\n#        sum(summary(as.factor(c(al1,al2))))\n#      hets<-c(names(freq1)[2],names(freq2)[2])\n#      if(length(freq1)>1 & length(freq2)>1){ #both must be polymorphic\n#        hs1<-2*freq1[1]*freq1[2]\n#        hs2<-2*freq2[1]*freq2[2]\n#        hs<-mean(c(hs1,hs2))\n#        ht<-2*freqall[1]*freqall[2]\n#        fst<-(ht-hs)/ht\n#      } else {\n#        hs1<-1-sum(freq1*freq1)\n#        hs2<-1-sum(freq2*freq2)\n#        if(length(freqall)<=1){ fst<-0 }\n#        else{ \n#          ht<-2*freqall[1]*freqall[2]\n#          fst<-NA\n#        }\n#      }\n#    }\n#    else {\n#      fst<-NA #gt2 doesn't pass coverage threshold\n#    }\n#  }else {\n#    fst<-NA #it doesn't pass the coverage threshold\n#  }\n\n#  return(data.frame(Chrom=vcf.row[\"#CHROM\"],Pos=vcf.row[\"POS\"],\n#                  Hs1=hs1,Hs2=hs2,Hs=hs,Ht=ht,Fst=fst,NumAlleles=length(factor(freqall)),\n#                  Num1=length(gt1),Num2=length(gt2)))\n#}#end function fst.one.vcf\n\nchoose.one.snp<-function(vcf){\n  keep.col<-colnames(vcf)\n  vcf$id.pos<-paste(vcf$ID,vcf$POS,sep=\".\")\n  sub.vcf<-tapply(vcf$id.pos,vcf$ID, sample,size=1)\n  new.vcf<-vcf[vcf$id.pos %in% sub.vcf,keep.col]\n  return(new.vcf)\n}\n\n\n\nfst.one.plink<-function(raw,group1, group2, cov.thresh=0.2){\n  fst.dat<-data.frame(Locus=character(),\n                      Hs1=numeric(),Hs2=numeric(),Hs=numeric(),Ht=numeric(),Fst=numeric(),NumAlleles=numeric(),\n                      Num1=numeric(),Num2=numeric(),stringsAsFactors=F)\n  grp1<-raw[raw$IID %in% group1,]\n  grp2<-raw[raw$IID %in% group2,]\n  for(i in 7:ncol(raw)){\n    na1<-length(grp1[is.na(grp1[,i]),i])/nrow(grp1)\n    na2<-length(grp2[is.na(grp2[,i]),i])/nrow(grp2)\n    gt1<-grp1[!is.na(grp1[,i]),i]\n    gt2<-grp2[!is.na(grp2[,i]),i]\n    gt1[gt1==\"1\"]<-\"1/2\"\n    gt1[gt1==\"2\"]<-\"2/2\"\n    gt1[gt1==\"0\"]<-\"1/1\"\n    gt2[gt2==\"1\"]<-\"1/2\"\n    gt2[gt2==\"2\"]<-\"2/2\"\n    gt2[gt2==\"0\"]<-\"1/1\"\n    \n    if(na1<=(1-cov.thresh)){\n      al1<-unlist(strsplit(as.character(gt1),split = \"/\"))\n      if(na2<=(1-cov.thresh)){\n        al2<-unlist(strsplit(as.character(gt2),split=\"/\"))\n        #calculate frequencies\n        fst<-calc.fst.wright(al1,al2)\n      }\n      else {\n        fst<-data.frame(Hs1=NA,Hs2=NA,Hs=NA,Ht=NA,Fst=NA,NumAlleles=length(factor(c(al1,al2))),\n                        Num1=length(al1),Num2=length(al2)) #gt2 doesn't pass coverage threshold\n      }\n    }else {\n      fst<-data.frame(Hs1=NA,Hs2=NA,Hs=NA,Ht=NA,Fst=NA,NumAlleles=length(factor(c(al1,al2))),\n                      Num1=length(al1),Num2=length(al2)) #it doesn't pass the coverage threshold\n    }\n    fst.dat[(i-6),]<-cbind(as.character(colnames(raw)[i]),fst[\"Hs1\"],fst[\"Hs2\"],as.numeric(fst[\"Hs\"]),fst[\"Ht\"],\n                           as.numeric(fst[\"Fst\"]),fst[\"NumAlleles\"],fst[\"Num1\"],fst[\"Num2\"])\n    \n  }\n  return(fst.dat)\n}#end fst.one.plink\n#################FILES#################\ndrad<-parse.vcf(\"drad.vcf\")\norad<-parse.vcf(\"orad.vcf\")\nboth<-parse.vcf(\"both.vcf\")\ndrad$SNP<-paste(drad$`#CHROM`,drad$POS,sep=\".\")\norad$SNP<-paste(orad$`#CHROM`,orad$POS,sep=\".\")\nboth$SNP<-paste(both$`#CHROM`,both$POS,sep=\".\")\nlocus.info<-c(\"#CHROM\",\"POS\",\"ID\",\"REF\",\"ALT\",\"QUAL\",\"FILTER\",\"INFO\",\"FORMAT\",\"SNP\")\no.ind<-grep(\"orad\",colnames(both),value=T)\nd.ind<-grep(\"sample\",colnames(both),value=T)\n\nboth.sub<-choose.one.snp(both)\ndrad.sub<-choose.one.snp(drad)\norad.sub<-choose.one.snp(orad)\n\ndsub<-read.delim(\"drad.subset.raw\",sep=\" \")\ndmap<-read.delim(\"drad.map\",header=F)\nosub<-read.delim(\"orad.subset.raw\",sep=\" \")\nomap<-read.delim(\"orad.map\",header=F)\nbsub<-read.delim(\"both.subset.raw\",sep=\" \")\nbmap<-read.delim(\"both.map\",header=F)\n\ndmap$SNP<-paste(dmap$V1,dmap$V4,sep=\".\")\nomap$SNP<-paste(omap$V1,omap$V4,sep=\".\")\nbmap$SNP<-paste(bmap$V1,bmap$V4,sep=\".\")\ncolnames(omap)<-c(\"Chrom\",\"oLocus\",\"dist\",\"Pos\",\"SNP\")\ncolnames(dmap)<-c(\"Chrom\",\"dLocus\",\"dist\",\"Pos\",\"SNP\")\ncolnames(bmap)<-c(\"Chrom\",\"Locus\",\"dist\",\"Pos\",\"SNP\")\n#################ANALYSIS#################\n##ran these already--read in files##\n#bo.cov<-do.call(\"rbind\",apply(both,1,vcf.cov.loc,subset=o.ind))\n#bd.cov<-do.call(\"rbind\",apply(both,1,vcf.cov.loc,subset=d.ind))\n#b.cov<-do.call(\"rbind\",apply(both,1,vcf.cov.loc,subset=c(o.ind,d.ind)))\n#bo.cov$SNP<-paste(bo.cov$Chrom,bo.cov$Pos,sep=\".\")\n#bd.cov$SNP<-paste(bd.cov$Chrom,bd.cov$Pos,sep=\".\")\n#b.cov$SNP<-paste(b.cov$Chrom,b.cov$Pos,sep=\".\")\n#o.cov<-do.call(\"rbind\",apply(orad,1,vcf.cov.loc,subset=o.ind))\n#o.cov$SNP<-paste(o.cov$Chrom,o.cov$Pos,sep=\".\")\n#d.cov<-do.call(\"rbind\",apply(drad,1,vcf.cov.loc,subset=d.ind))\n#d.cov$SNP<-paste(d.cov$Chrom,d.cov$Pos,sep=\".\")\n#loc.cov<-merge(o.cov,d.cov,by=\"SNP\")\n#because some of them have no alt\n#loc.cov$AvgCovRatio.x[loc.cov$AvgCovRatio.x==\"Inf\"]<-loc.cov[loc.cov$AvgCovRatio.x==\"Inf\",\"AvgCovRef.x\"]\n#loc.cov$AvgCovRatio.y[loc.cov$AvgCovRatio.y==\"Inf\"]<-loc.cov[loc.cov$AvgCovRatio.y==\"Inf\",\"AvgCovRef.y\"]\n#write.csv(b.cov,\"Both_overallCov.csv\")\n#write.csv(bo.cov,\"Both_sdRADCov.csv\")\n#write.csv(bd.cov,\"Both_ddRADCov.csv\")\n#write.csv(o.cov,\"Sep_sdRADCov.csv\")\n#write.csv(d.cov,\"Sep_ddRADCov.csv\")\n#write.csv(loc.cov,\"Sep_Combined.csv\")\nb.cov<-read.csv(\"Both_overallCov.csv\",row.names=1)\nb.cov$SNP<-paste(b.cov$Chrom,b.cov$Pos,sep=\".\")\nbo.cov<-read.csv(\"Both_sdRADCov.csv\",row.names=1)\nbo.cov$SNP<-paste(bo.cov$Chrom,bo.cov$Pos,sep=\".\")\nbd.cov<-read.csv(\"Both_ddRADCov.csv\",row.names=1)\nbd.cov$SNP<-paste(bd.cov$Chrom,bd.cov$Pos,sep=\".\")\no.cov<-read.csv(\"Sep_sdRADCov.csv\",row.names=1)\no.cov$SNP<-paste(o.cov$Chrom,o.cov$Pos,sep=\".\")\nd.cov<-read.csv(\"Sep_ddRADCov.csv\",row.names=1)\nd.cov$SNP<-paste(d.cov$Chrom,d.cov$Pos,sep=\".\")\nloc.cov<-read.csv(\"Sep_Combined.csv\",row.names=1)\nloc.cov$SNP<-paste(loc.cov$Chrom.x,loc.cov$Pos.x,sep=\".\")\n\nbo.cov$AvgCovRatio[is.na(bo.cov$AvgCovRatio)]<-0\nbo.cov$AvgCovRatio[bo.cov$AvgCovRatio==\"Inf\"]<-bo.cov[bo.cov$AvgCovRatio==\"Inf\",\"AvgCovRef\"]\nbd.cov$AvgCovRatio[bd.cov$AvgCovRatio==\"Inf\"]<-bd.cov[bd.cov$AvgCovRatio==\"Inf\",\"AvgCovRef\"]\n\n##SUBSET\nb.cov<-b.cov[b.cov$SNP %in% both.sub$SNP,]\nbo.cov<-bo.cov[bo.cov$SNP %in% both.sub$SNP & bo.cov$SNP %in% orad.sub$SNP,]\nbd.cov<-bd.cov[bd.cov$SNP %in% both.sub$SNP & bd.cov$SNP %in% drad.sub$SNP,]\no.cov<-o.cov[o.cov$SNP %in% orad.sub$SNP,]\nd.cov<-d.cov[d.cov$SNP %in% drad.sub$SNP,]\nloc.cov<-loc.cov[loc.cov$SNP %in% orad.sub$SNP & loc.cov$SNP %in% drad.sub$SNP,]\n####Average Coverage####\n#compare sd vs dd\nlc.comp<-data.frame(LibraryPrep=c(rep(\"sdRAD\",nrow(o.cov)),rep(\"ddRAD\",nrow(d.cov)),\n    rep(\"sdRAD\",nrow(bo.cov)),rep(\"ddRAD\",nrow(bd.cov))), \n  Assembly=c(rep(\"Alone\",nrow(o.cov)),rep(\"Alone\",nrow(d.cov)),\n             rep(\"Together\",nrow(bo.cov)),rep(\"Together\",nrow(bd.cov))),\n  AvgCovRatio=c(o.cov$AvgCovRatio,d.cov$AvgCovRatio,bo.cov$AvgCovRatio,bd.cov$AvgCovRatio),\n  AvgCovTotal=c(o.cov$AvgCovTotal,d.cov$AvgCovTotal,bo.cov$AvgCovTotal,bd.cov$AvgCovTotal))\n#NumReadsPerInd=c(oc$NumReadsAlone,dc$NumReadsAlone,oc$NumReadsTogether,dc$NumReadsTogether)\n\n#total coverage\nsummary(aov(log(lc.comp$AvgCovTotal)~lc.comp$LibraryPrep*lc.comp$Assembly))\nTukeyHSD(aov(log(lc.comp$AvgCovTotal)~lc.comp$LibraryPrep*lc.comp$Assembly))#use this!\nsummary(lm(log(lc.comp$AvgCovTotal)~lc.comp$LibraryPrep*lc.comp$Assembly))\nboxplot(log(lc.comp$AvgCovTotal)~lc.comp$LibraryPrep*lc.comp$Assembly)\n#ref/alt ratio\nsummary(aov(lc.comp$AvgCovRatio~lc.comp$LibraryPrep*lc.comp$Assembly))\nTukeyHSD(aov(log(lc.comp$AvgCovRatio+1)~lc.comp$LibraryPrep*lc.comp$Assembly))#use this!\nsummary(lm(lc.comp$AvgCovRatio~lc.comp$LibraryPrep*lc.comp$Assembly))\nboxplot(log(lc.comp$AvgCovRatio+1)~lc.comp$LibraryPrep*lc.comp$Assembly)\n\n####PLOT: Coverage comparison boxplot####\njpeg(\"CoverageComparisonBoxplot.jpeg\",height=7,width=7,units=\"in\",res=300)\npar(mfrow=c(2,1),oma=c(1,2,1,1),mar=c(2,2,2,2))\nboxplot(log(lc.comp$AvgCovRatio+1)~lc.comp$LibraryPrep*lc.comp$Assembly,names=F,\n        xaxt='n',col=c(\"cadetblue\",\"coral1\"))\naxis(1,at=c(1.5,3.5),labels=c(\"Alone\",\"Together\"))\nmtext(\"log(Avg Ratio Num Reads\\nRef/Alt)\",2,outer=F,line=2)\nlegend(\"topleft\",c(\"sdRAD\",\"ddRAD\"),col=c(\"cadetblue\",\"coral1\"),pch=15,bty='n')\nboxplot(log(lc.comp$AvgCovTotal+1)~lc.comp$LibraryPrep*lc.comp$Assembly,names=F,\n        xaxt='n',col=c(\"cadetblue\",\"coral1\"))\nmtext(\"log(Avg Num Reads\\nPer Individual Per Locus)\",2,outer=F,line=2)\naxis(1,at=c(1.5,3.5),labels=c(\"Alone\",\"Together\"))\ndev.off()\n\n####Coverage by individual--assembled in one####\n##Generate the dataset##\n#o.icov<-as.data.frame(do.call(\"rbind\",apply(both[,o.ind],2,vcf.cov.ind)))\n#o.icov$Method<-rep(\"oRAD\",nrow(o.icov))\n#d.icov<-as.data.frame(do.call(\"rbind\",apply(both[,d.ind],2,vcf.cov.ind)))\n#d.icov$Method<-rep(\"dRAD\",nrow(d.icov))\n#ind.cov<-as.data.frame(rbind(o.icov,d.icov))\n#ind.cov$NumReads<-as.numeric(ind.cov$AvgCovTot)*as.numeric(ind.cov$NumPresent)\n#ic<-as.data.frame(apply(ind.cov,2,as.numeric))\n#rownames(ic)<-rownames(ind.cov)\n#ic$Method<-as.factor(ind.cov$Method)\n##Coverage by individual--assembled separately\n#orad.icov<-as.data.frame(do.call(\"rbind\",apply(orad[,10:ncol(orad)],2,vcf.cov.ind)))\n#oic<-apply(orad.icov,2,as.numeric)\n#rownames(oic)<-rownames(orad.icov)\n#drad.icov<-as.data.frame(do.call(\"rbind\",apply(drad[,10:ncol(drad)],2,vcf.cov.ind)))\n#dic<-apply(drad.icov,2,as.numeric)\n#rownames(dic)<-rownames(drad.icov)\n##write these to file so I can easily pick back up later\n#write.table(oic,\"orad_coverage.csv\",quote=T,row.names=T,col.names=T,sep='\\t')\n#write.table(dic,\"drad_coverage.csv\",quote=T,row.names=T,col.names=T,sep='\\t')\n#write.table(ic,\"both_coverage.csv\",quote=T,row.names=T,col.name=T,sep='\\t')\noic<-read.delim(\"orad_coverage.csv\")\ndic<-read.delim(\"drad_coverage.csv\")\nic<-read.delim(\"both_coverage.csv\")\n#subset\no.icov<-as.data.frame(do.call(\"rbind\",apply(both.sub[,o.ind],2,vcf.cov.ind)))\no.icov$Method<-rep(\"oRAD\",nrow(o.icov))\nd.icov<-as.data.frame(do.call(\"rbind\",apply(both.sub[,d.ind],2,vcf.cov.ind)))\nd.icov$Method<-rep(\"dRAD\",nrow(d.icov))\nind.cov<-as.data.frame(rbind(o.icov,d.icov))\nind.cov$NumReads<-as.numeric(ind.cov$AvgCovTot)*as.numeric(ind.cov$NumPresent)\nic<-as.data.frame(apply(ind.cov,2,as.numeric))\nrownames(ic)<-rownames(ind.cov)\nic$Method<-as.factor(ind.cov$Method)\n#Coverage by individual--assembled separately\norad.icov<-as.data.frame(do.call(\"rbind\",apply(orad.sub[,10:ncol(orad.sub)],2,vcf.cov.ind)))\noic<-apply(orad.icov,2,as.numeric)\nrownames(oic)<-rownames(orad.icov)\ndrad.icov<-as.data.frame(do.call(\"rbind\",apply(drad.sub[,10:ncol(drad.sub)],2,vcf.cov.ind)))\ndic<-apply(drad.icov,2,as.numeric)\nrownames(dic)<-rownames(drad.icov)\n#write these to file so I can easily pick back up later\nwrite.table(oic,\"orad_coverage_subset.csv\",quote=T,row.names=T,col.names=T,sep='\\t')\nwrite.table(dic,\"drad_coverage_subset.csv\",quote=T,row.names=T,col.names=T,sep='\\t')\nwrite.table(ic,\"both_coverage_subset.csv\",quote=T,row.names=T,col.name=T,sep='\\t')\n\nic.o<-ic[rownames(ic) %in% rownames(oic),]\nic.d<-ic[rownames(ic) %in% rownames(dic),]\n\nmo<-merge(ic.o,oic,by=0)\nmd<-merge(ic.d,dic,by=0)\noc<-data.frame(NumReadsTogether=mo$NumReads.x,NumReadsAlone=mo$NumReads.y,row.names=mo$Row.names)\ndc<-data.frame(NumReadsTogether=md$NumReads.x,NumReadsAlone=md$NumReads.y,row.names=md$Row.names)\nt.test(oc$NumReadsTogether,oc$NumReadsAlone,paired=T,alternative=\"less\")\nt.test(dc$NumReadsTogether,dc$NumReadsAlone,paired=T,alternative=\"greater\")\nwilcox.test(oc$NumReadsTogether,oc$NumReadsAlone,paired=T,alternative=\"less\")\nwilcox.test(dc$NumReadsTogether,dc$NumReadsAlone,paired=T,alternative=\"greater\")\noic<-as.data.frame(oic)\ndic<-as.data.frame(dic)\noic<-oic[o.ind,]#they had SNP as a row\ndic<-dic[d.ind,]\nind.cov<-data.frame(LibraryPrep=c(rep(\"sdRAD\",nrow(oic)),rep(\"ddRAD\",nrow(dic)),\n    rep(\"sdRAD\",nrow(oic)),rep(\"ddRAD\",nrow(dic))), \n  Assembly=c(rep(\"Alone\",nrow(oic)),rep(\"Alone\",nrow(dic)),\n    rep(\"Together\",nrow(ic))),\n  NumReads=c(oic$NumReads,dic$NumReads,ic$NumReads),\n  NumMissing=c(oic$NumMissing,dic$NumMissing,ic$NumMissing),\n  NumPresent=c(oic$NumPresent,dic$NumPresent,ic$NumPresent))\n\nsummary(lm(log(ind.cov$NumReads)~ind.cov$LibraryPrep*ind.cov$Assembly))\nsummary(glm(log(ind.cov$NumReads)~ind.cov$LibraryPrep*ind.cov$Assembly))\nsummary(glm(cbind(ind.cov$NumMissing,ind.cov$NumPresent)~ind.cov$LibraryPrep*ind.cov$Assembly,family=binomial))\nsummary(aov(log(ind.cov$NumReads)~ind.cov$LibraryPrep*ind.cov$Assembly))\nTukeyHSD(aov(log(ind.cov$NumReads)~ind.cov$LibraryPrep*ind.cov$Assembly))\n\n####PLOT: Fig 1. Coverage Assembly Method Comp####\njpeg(\"CoverageAssemblyMethodComp_Subset.jpeg\",height=10.5,width=8,units=\"in\",res=300)\npar(mfrow=c(3,2),oma=c(1,1,1,1),mar=c(2,2,2,2))\npar(mar=c(2,3,2,1))\nhist(oc$NumReadsTogether, col=rgb(0,0,1,0.5), ylim=c(0,30), breaks=seq(0,3500000,250000),\n     main=\"sdRAD-seq\",axes=F,xlim=c(0,3500000))\nhist(oc$NumReadsAlone,col=rgb(1,0,0,0.5), add=T,breaks=seq(0,3500000,250000))\naxis(1,pos=0)\naxis(2,pos=0,las=1)\nmtext(\"Number of Individuals\",2.5,outer=F,line=2,cex=0.75)\npar(mar=c(2,2,2,2))\nhist(dc$NumReadsTogether, col=rgb(0,0,1,0.5), ylim=c(0,150), breaks=seq(0,1500000,100000),\n     main=\"ddRAD-seq\",axes=F)\nhist(dc$NumReadsAlone,col=rgb(1,0,0,0.5), add=T,breaks=seq(0,1500000,100000))\naxis(1,pos=0)\naxis(2,pos=0,las=1)\nlegend(\"topright\",c(\"Assembled Together\", \"Assembled Separately\"),pch=15,col=c(rgb(1,0,0,0.5),rgb(0,0,1,0.5)),bty='n')\nmtext(\"Total Number of Reads\",1,outer=T,cex=0.75,line=-52)#-29 for R\n\npar(mar=c(2,3,2,1))\nhist(log(bo.cov$AvgCovTotal),col=rgb(0,0,1,0.5),axes=F,xlab=\"\",ylab=\"\",main=\"\",\n     xlim=c(0,10.5),ylim=c(0,80000),breaks=seq(0,10.5,0.75))\nhist(log(o.cov$AvgCovTotal), col=rgb(1,0,0,0.5), add=T,breaks=seq(0,10.5,0.75))\naxis(1,pos=0)\naxis(2,pos=0,las=1)\nmtext(\"Number of Loci\",2,outer=F,line=2.5,cex=0.75)\npar(mar=c(2,2,2,2))\nhist(log(bd.cov$AvgCovTotal), col=rgb(0,0,1,0.5),main=\"\",axes=F,ylab=\"\",xlab=\"\",\n     xlim=c(0,8),ylim=c(0,15000),breaks=seq(0,8,0.5))\nhist(log(d.cov$AvgCovTotal), col=rgb(1,0,0,0.5), add=T,breaks=seq(0,8,0.5))\naxis(1,pos=0)\naxis(2,pos=0,las=1)\nmtext(\"ln(Average Number of Reads Per Individual Per SNP)\",1,outer=T,line=-27,cex=0.75)#-15 for R\n\npar(mar=c(2,3,2,1))\nhist(log(bo.cov$AvgCovRatio),col=rgb(0,0,1,0.5),main=\"\",axes=F,xlab=\"\",ylab=\"\",breaks=seq(-5,5,1),ylim=c(0,50000),xlim=c(-5,7))\nhist(log(o.cov$AvgCovRatio), col=rgb(1,0,0,0.5), add=T,breaks=seq(-5,7,1))\naxis(1,pos=0)\naxis(2,pos=-5,las=1)\nmtext(\"Number of Loci\",2,outer=F,line=2.5,cex=0.75)\npar(mar=c(2,2,2,2))\nhist(log(bd.cov$AvgCovRatio), col=rgb(0,0,1,0.5),main=\"\",axes=F,ylab=\"\",xlab=\"\",breaks=seq(-2,5,0.5),ylim=c(0,10000),xlim=c(-2,5))\nhist(log(d.cov$AvgCovRatio), col=rgb(1,0,0,0.5), add=T,breaks=seq(-5,5,0.5))\naxis(1,pos=0)\naxis(2,pos=-2,las=1)\nmtext(\"ln(Average Number of Reads in Ref/Avg Number of Reads in Alt)\",1,outer=T,cex=0.75)\ndev.off()\n\n\n\n####Variance in coverage####\n#assembled separately\nhist(log(o.cov$CovVariance),col=alpha(\"cadetblue\",0.5))\nhist(log(d.cov$CovVariance),col=alpha(\"coral1\",0.5),add=T)\nboxplot(log(o.cov$CovVariance+1),log(d.cov$CovVariance+1),col=c(\"cadetblue\",\"coral1\"),\n        names=c(\"sdRAD\",\"ddRAD\"),ylab=\"Variance in Coverage\",ylim=c(0,22))\ntext(x=c(1,2),y=c(21,21),c(\"250425\",\"69109\"))\nwilcox.test(log(o.cov$CovVariance+1),log(d.cov$CovVariance+1),\"greater\")\n\nd.sub<-d.cov[sample(nrow(d.cov),30000,replace=F),]\no.sub<-o.cov[sample(nrow(o.cov),30000,replace=F),]\nwilcox.test(log(o.sub$CovVariance+1),log(d.sub$CovVariance+1),\"greater\")\nboxplot(log(o.sub$CovVariance+1),log(d.sub$CovVariance+1),col=c(\"cadetblue\",\"coral1\"),\n        names=c(\"sdRAD\",\"ddRAD\"),ylab=\"Variance in Coverage\")\n\n#assembled together\nwilcox.test(bo.cov$CovVariance,bd.cov$CovVariance,paired=T,\"less\")\n\n\n###Heterozygosity\n#assembled separately\nhist(o.cov$PropHet,col=alpha(\"cadetblue\",0.5))\nhist(d.cov$PropHet,col=alpha(\"coral1\",0.5),add=T)\nboxplot(o.cov$PropHet,d.cov$PropHet,col=c(\"cadetblue\",\"coral1\"),\n        names=c(\"sdRAD\",\"ddRAD\"),ylab=\"Proportion Heterozygous\")\ntext(x=c(1,2),y=c(21,21),c(\"250425\",\"69109\"))\nwilcox.test(o.cov$PropHet,d.cov$PropHet,\"less\")\n\n#what about in 30 males 30 females from ddRAD and the sdRAD?\nd.mal<-colnames(drad)[grep(\"PRM\",colnames(drad))]\nd.fem<-colnames(drad)[grep(\"FEM\",colnames(drad))]\ndm.sub<-sample(d.mal,30)\ndf.sub<-sample(d.fem,30)\nd.sub<-cbind(drad[,1:9],drad[,dm.sub],drad[,df.sub])\nds.cov<-do.call(\"rbind\",apply(d.sub,1,vcf.cov.loc,subset=c(dm.sub,df.sub)))\n\nwilcox.test(o.cov$PropHet,ds.cov$PropHet,\"less\")\nwilcox.test(o.cov$AvgCovRatio,ds.cov$AvgCovRatio,\"less\")\nwilcox.test(o.cov$CovVariance,ds.cov$CovVariance,\"greater\")\n\n#assembled together\nwilcox.test(bo.cov$PropHet,bd.cov$PropHet,paired=T,\"less\")\n\n##The real analysis\nlcv.comp<-data.frame(LibraryPrep=c(rep(\"sdRAD\",nrow(o.cov)),rep(\"ddRAD\",nrow(d.cov)),\n                                  rep(\"sdRAD\",nrow(bo.cov)),rep(\"ddRAD\",nrow(bd.cov))), \n                    Assembly=c(rep(\"Alone\",nrow(o.cov)),rep(\"Alone\",nrow(d.cov)),\n                               rep(\"Together\",nrow(bo.cov)),rep(\"Together\",nrow(bd.cov))),\n                    CovVariance=c(o.cov$CovVariance,d.cov$CovVariance,bo.cov$CovVariance,bd.cov$CovVariance),\n                    PropHet=c(o.cov$PropHet,d.cov$PropHet,bo.cov$PropHet,bd.cov$PropHet))\n\nsummary(aov(log(lcv.comp$CovVariance+1)~lcv.comp$LibraryPrep*lcv.comp$Assembly))\nTukeyHSD(aov(log(lcv.comp$CovVariance+1)~lcv.comp$LibraryPrep*lcv.comp$Assembly))\nsummary(aov(lcv.comp$PropHet~lcv.comp$LibraryPrep*lcv.comp$Assembly))\nTukeyHSD(aov(lcv.comp$PropHet~lcv.comp$LibraryPrep*lcv.comp$Assembly))\n\njpeg(\"VarianceInCov.jpeg\",height=8.5,width=7,units=\"in\",res=300)\npar(mfrow=c(2,1),oma=c(1,2,1,1),mar=c(2,2,2,2))\nboxplot(log(lcv.comp$CovVariance+1)~lcv.comp$LibraryPrep*lcv.comp$Assembly,col=c(\"cadetblue\",\"coral1\"),\n        names=F,xaxt='n')\naxis(1,at=c(1.5,3.5),c(\"Alone\",\"Together\"))\nmtext(\"ln(Variance in Coverage)\",2,outer=F,line=2)\nlegend(\"topleft\",ncol=2,c(\"ddRAD\",\"sdRAD\"),pch=15,col=c(\"cadetblue\",\"coral1\"),bty='n')\nboxplot(lcv.comp$PropHet~lcv.comp$LibraryPrep*lcv.comp$Assembly,col=c(\"cadetblue\",\"coral1\"),\n        names=F,xaxt='n')\nmtext(\"Proportion Heterozygotes\",2,outer=F,line=2)\naxis(1,at=c(1.5,3.5),c(\"Alone\",\"Together\"))\ndev.off()\n\n###########################LOOKING FOR THE SAME LOCI#################################\n#sdRAD-ddRAD\nod.loci<-merge(orad[,locus.info],drad[,locus.info],\"SNP\")\nod.loci<-merge(orad.sub[,locus.info],drad.sub[,locus.info],\"SNP\")\ndim(od.loci[(od.loci$REF.x != od.loci$REF.y & od.loci$REF.x != od.loci$ALT.y) |\n               (od.loci$REF.x != od.loci$REF.y & od.loci$REF.y != od.loci$ALT.x),])\n    \n               dim(od.loci[(od.loci$REF.x != od.loci$REF.y & od.loci$ALT.x != od.loci$ALT.y &\n                  od.loci$REF.x != od.loci$ALT.y & od.loci$REF.y != od.loci$ALT.x) ,])\nod.cov<-merge(o.cov,d.cov,\"SNP\")\n\nwilcox.test(od.cov$PropHet.x,od.cov$PropHet.y,paired=T,\"less\")\nwilcox.test(od.cov$CovVariance.x,od.cov$CovVariance.y,paired=T,\"greater\")\nwilcox.test(od.cov$AvgCovRatio.x,od.cov$AvgCovRatio.y,paired=T,\"greater\")\n\n#sdRAD-both\nob.loci<-merge(orad[,locus.info],both[,locus.info],\"SNP\")\nob.loci<-merge(orad.sub[,locus.info],both.sub[,locus.info],\"SNP\")#subset\ndim(ob.loci[(ob.loci$REF.x != ob.loci$REF.y & ob.loci$REF.x != ob.loci$ALT.y) |\n              (ob.loci$REF.x != ob.loci$REF.y & ob.loci$REF.y != ob.loci$ALT.x),])\ndim(ob.loci[(ob.loci$REF.x != ob.loci$REF.y & ob.loci$ALT.x != ob.loci$ALT.y &\n               ob.loci$REF.x != ob.loci$ALT.y & ob.loci$REF.y != ob.loci$ALT.x) ,])\nob.cov<-merge(o.cov,b.cov,\"SNP\")\nwilcox.test(ob.cov$PropHet.x,ob.cov$PropHet.y,paired=T,\"less\")\nwilcox.test(ob.cov$CovVariance.x,ob.cov$CovVariance.y,paired=T,\"greater\")\nwilcox.test(ob.cov$AvgCovRatio.x,ob.cov$AvgCovRatio.y,paired=T,\"less\")\n\n#ddRAD-both\ndb.loci<-merge(drad[,locus.info],both[,locus.info],\"SNP\")\ndb.loci<-merge(drad.sub[,locus.info],both.sub[,locus.info],\"SNP\")#subset\ndim(db.loci[(db.loci$REF.x != db.loci$REF.y & db.loci$REF.x != db.loci$ALT.y) |\n              (db.loci$REF.x != db.loci$REF.y & db.loci$REF.y != db.loci$ALT.x),])\ndim(db.loci[(db.loci$REF.x != db.loci$REF.y & db.loci$ALT.x != db.loci$ALT.y &\n               db.loci$REF.x != db.loci$ALT.y & db.loci$REF.y != db.loci$ALT.x) ,])\ndb.cov<-merge(d.cov,b.cov,\"SNP\")\nwilcox.test(db.cov$PropHet.x,db.cov$PropHet.y,paired=T,\"greater\")\nwilcox.test(db.cov$CovVariance.x,db.cov$CovVariance.y,paired=T,\"less\")\nwilcox.test(db.cov$AvgCovRatio.x,db.cov$AvgCovRatio.y,paired=T,\"less\")\n\n#sd/dd-both\nsdb.loci<-merge(od.loci,both[,locus.info],\"SNP\")\nsdb.loci<-merge(od.loci,both.sub[,locus.info],\"SNP\")#subset\ndim(sdb.loci[(sdb.loci$REF.x != sdb.loci$REF.y & sdb.loci$REF.x != sdb.loci$REF\n              & sdb.loci$REF.x != sdb.loci$ALT.y & sdb.loci$REF.x != sdb.loci$ALT) |\n               (sdb.loci$ALT.x != sdb.loci$REF.y & sdb.loci$ALT.x != sdb.loci$REF\n                & sdb.loci$ALT.x != sdb.loci$ALT.y & sdb.loci$ALT.x != sdb.loci$ALT) |\n               (sdb.loci$REF.y != sdb.loci$REF.x & sdb.loci$REF.y != sdb.loci$REF\n                & sdb.loci$REF.y != sdb.loci$ALT.x & sdb.loci$REF.y != sdb.loci$ALT) |\n               (sdb.loci$ALT.y != sdb.loci$REF.x & sdb.loci$ALT.y != sdb.loci$REF\n                & sdb.loci$ALT.y != sdb.loci$ALT.y & sdb.loci$ALT.y != sdb.loci$ALT) |\n               (sdb.loci$REF != sdb.loci$REF.x & sdb.loci$REF != sdb.loci$REF.x\n                & sdb.loci$REF != sdb.loci$ALT.y & sdb.loci$REF != sdb.loci$ALT.x) |\n               (sdb.loci$ALT != sdb.loci$REF.y & sdb.loci$ALT != sdb.loci$REF.x\n                & sdb.loci$ALT != sdb.loci$ALT.y & sdb.loci$ALT.x != sdb.loci$ALT) ,])\n\n#########################FSTS FROM INDEPENDENT ANALYSES##############################\npop1<-colnames(orad)[10:ncol(orad)]\npop2<-colnames(drad)[10:ncol(drad)]\no.share<-orad[orad$SNP %in% od.loci$SNP,]\nd.share<-drad[drad$SNP %in% od.loci$SNP,]\nod.vcf<-merge(orad,drad,\"SNP\")\n#subset\no.share<-orad.sub[orad.sub$SNP %in% od.loci$SNP,]\nd.share<-drad.sub[drad.sub$SNP %in% od.loci$SNP,]\nod.sub<-merge(orad.sub,drad.sub,\"SNP\")\nod.fst<-do.call(\"rbind\",apply(o.share,1,fst.two.vcf,vcf2=d.share,match.index=\"SNP\",cov.thresh=0.5))\nod.fst$SNP<-paste(od.fst$Chrom,as.numeric(as.character(od.fst$Pos)),sep=\".\")\n#od.fst<-do.call(\"rbind\",apply(o.share,1,fst.two.vcf,vcf2=d.share,match.index=\"SNP\"))\n#write.table(od.fst,\"orad-drad.fst.txt\",col.names=T,row.names=F,quote=F,sep='\\t')\nod.fst<-read.table(\"orad-drad.fst.txt\",header=T,sep='\\t')\no.cov.pass<-o.cov[o.cov$AvgCovTotal > 3 & o.cov$AvgCovTotal <= 50, \"SNP\"]\nd.cov.pass<-d.cov[d.cov$AvgCovTotal > 3 & d.cov$AvgCovTotal <= 50, \"SNP\"]\nsep.cov.pass<-o.cov.pass[o.cov.pass %in% d.cov.pass]\n\n#FROM SAME ANALYSIS\nboth$SNP<-paste(both$`#CHROM`,both$POS,sep=\".\")\nboth.o<-cbind(both[,locus.info],both[,o.ind])\nboth.d<-cbind(both[,locus.info],both[,d.ind])\n#subset\nboth.o<-cbind(both.sub[,locus.info],both.sub[,o.ind])\nboth.d<-cbind(both.sub[,locus.info],both.sub[,d.ind])\nod.both.fst<-do.call(\"rbind\",apply(both.o,1,fst.two.vcf,vcf2=both.d,match.index=\"SNP\",cov.thresh=0.5))\nod.both.fst$SNP<-paste(od.both.fst$Chrom,as.numeric(as.character(od.both.fst$Pos)),sep=\".\")\nod.fst.1<-od.both.fst[od.both.fst$Fst ==1,]\nbd.cov$SNP<-paste(bd.cov$Chrom,bd.cov$Pos,sep=\".\")\nbo.cov$SNP<-paste(bo.cov$Chrom,bo.cov$Pos,sep=\".\")\nbd.cov.pass<-bd.cov[bd.cov$AvgCovTotal > 3 & bd.cov$AvgCovTotal <=50,\"SNP\"]\nbo.cov.pass<-bo.cov[bo.cov$AvgCovTotal > 3 & bo.cov$AvgCovTotal <=50,\"SNP\"]\ncov.pass<-bd.cov.pass[bd.cov.pass %in% bo.cov.pass]\nsummary(od.both.fst[od.both.fst$SNP %in% cov.pass,\"Fst\"])\nfsts.both<-do.call(\"rbind\",apply(both.sub,1,fst.one.vcf,group1=o.ind,group2=d.ind,cov.thresh=0.5))\n\n\n##########PLOTTING###########\nlgs<-c(\"LG1\",\"LG2\",\"LG3\",\"LG4\",\"LG5\",\"LG6\",\"LG7\",\"LG8\",\"LG9\",\"LG10\",\"LG11\",\n       \"LG12\",\"LG13\",\"LG14\",\"LG15\",\"LG16\",\"LG17\",\"LG18\",\"LG19\",\"LG20\",\"LG21\",\n       \"LG22\")\nlgn<-seq(1,22)\nscaffs<-levels(as.factor(od.fst[,\"Chrom\"]))\nscaffs[1:22]<-lgs\n\njpeg(\"sd-dd_Fst_subset.jpeg\",height=10,width=7.5,units=\"in\",res=300)\npar(mfrow=c(4,1),mar=c(2,2,2,2),oma=c(1,2,1,1))\n##Separate\nod<-fst.plot(od.fst[!is.na(od.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n  fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n  groups=as.factor(scaffs[scaffs %in% levels(factor(od.fst$Chrom[!is.na(od.fst$Fst)]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(od[od$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(od[od$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately\",3,cex=0.75)\nodc<-fst.plot(od.fst[!is.na(od.fst$Fst) & od.fst$SNP %in% cov.pass,],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n             fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n             groups=as.factor(scaffs[scaffs %in% levels(factor(od.fst$Chrom[!is.na(od.fst$Fst)& od.fst$SNP %in% cov.pass]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odc[odc$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odc[odc$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately, Coverage Filter\",3,cex=0.75)\n\n##Together\nodb<-fst.plot(od.both.fst[!is.na(od.both.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(od.both.fst[!is.na(od.both.fst$Fst),\"Chrom\"]))]))\nodb$Pos<-as.numeric(as.character(odb$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odb[odb$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odb[odb$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together\",3,cex=0.75)\nodbc<-fst.plot(od.both.fst[!is.na(od.both.fst$Fst) & od.both.fst$SNP %in% sep.cov.pass,],\n  ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), y.lim=c(0,1),\n  fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,\n  groups=as.factor(scaffs[scaffs %in% \n    levels(factor(od.both.fst[!is.na(od.both.fst$Fst) & od.both.fst$SNP %in% sep.cov.pass,\"Chrom\"]))]))\nodbc$Pos<-as.numeric(as.character(odbc$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odbc[odbc$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odbc[odbc$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together, Coverage Filter\",3,cex=0.75)\nmtext(expression(italic(F)[ST]),2,outer=T,cex=0.75)\ndev.off()\n\nfst.aov.dat<-data.frame(Fst=c(od$Fst,odb$Fst,odc$Fst,odbc$Fst),\n  Type=c(rep(\"Alone\",nrow(od)),rep(\"Together\",nrow(odb)),rep(\"Alone\",nrow(odc)),rep(\"Together\",nrow(odbc))),\n  Filtered=c(rep(\"Unfiltered\",nrow(od)),rep(\"Unfiltered\",nrow(odb)),rep(\"Filtered\",nrow(odc)),rep(\"Filtered\",nrow(odbc))))\nfst.aov<-aov(Fst~Type*Filtered,dat=fst.aov.dat)\n\ngwsca<-read.delim(\"gwsca_fsts_both.txt\")\n\ndrad.test<-sample(d.ind,120)\ndrad.tes.fst<-do.call(\"rbind\", apply(both, 1, fst.one.vcf,group1=drad.test[1:60],group2=drad.test[61:120],cov.thresh=0.2))\n\n####PLINK SUBSETS####\ndsub<-read.delim(\"drad.subset.raw\",sep=\" \")\ndmap<-read.delim(\"drad.map\",header=F)\nosub<-read.delim(\"orad.subset.raw\",sep=\" \")\nomap<-read.delim(\"orad.map\",header=F)\nbsub<-read.delim(\"both.subset.raw\",sep=\" \")\nbmap<-read.delim(\"both.map\",header=F)\n\n#Match dsub and osub\nmerge.map<-merge(omap,dmap,by=\"SNP\")\nmerge.map$oLocus<-apply(merge.map,1,function(x){\n  x[\"oLocus\"]<-paste(\"X\",x[\"oLocus\"],sep=\"\")\n})\nmerge.map$dLocus<-apply(merge.map,1,function(x){\n  x[\"dLocus\"]<-paste(\"X\",x[\"dLocus\"],sep=\"\")\n})\n#match orad\no.newcol<-colnames(osub)\no.newcol<-unlist(lapply(o.newcol,function(x){\n  o.newcol<-gsub(\"(X\\\\d+_\\\\d+)_\\\\w\",\"\\\\1\",x)\n}))\ncolnames(osub)<-o.newcol\nomerge.keep<-merge.map[merge.map$oLocus %in% colnames(osub),]\nomerge.keep<-omerge.keep[!duplicated(omerge.keep$oLocus),]\nodsub<-osub[,colnames(osub)%in%omerge.keep$oLocus]\nodsub<-odsub[,order(colnames(odsub))]\nomerge.keep<-omerge.keep[order(omerge.keep$oLocus),]\ncolnames(odsub)<-omerge.keep[omerge.keep$oLocus %in% colnames(odsub),\"SNP\"]\nmo<-odsub[,!duplicated(colnames(odsub))]\n#match drad\nd.newcol<-colnames(dsub)\nd.newcol<-unlist(lapply(d.newcol,function(x){\n  d.newcol<-gsub(\"(X\\\\d+_\\\\d+)_\\\\w\",\"\\\\1\",x)\n}))\ncolnames(dsub)<-d.newcol\ndmerge.keep<-merge.map[merge.map$dLocus %in% colnames(dsub),]\ndmerge.keep<-dmerge.keep[!duplicated(dmerge.keep$dLocus),]\nddsub<-dsub[,colnames(dsub)%in%dmerge.keep$dLocus]\nddsub<-ddsub[,order(colnames(ddsub))]\ndmerge.keep<-dmerge.keep[order(dmerge.keep$dLocus),]\ncolnames(ddsub)<-dmerge.keep[dmerge.keep$dLocus %in% colnames(ddsub),\"SNP\"]\nmd<-ddsub[,!duplicated(colnames(ddsub))]\nmo<-mo[,order(colnames(mo))]\nmd<-md[,order(colnames(md))]\nmergedsub<-data.frame(rbind(cbind(osub[,1:6],mo[,colnames(mo) %in% colnames(md)]),\n  cbind(dsub[,1:6],md[,colnames(md)%in% colnames(mo)])))\n#fsts\nplink.diff.fst<-fst.one.plink(mergedsub,group1 = osub$IID,group2 = dsub$IID)\nplink.both.fst<-fst.one.plink(bsub,group1 = osub$IID,group2 = dsub$IID)\nplink.diff.fst$Chrom<-gsub(\"(\\\\w+\\\\d+).\\\\d+\",\"\\\\1\",plink.diff.fst$Locus)\nplink.diff.fst$Pos<-gsub(\"(\\\\w+\\\\d+).(\\\\d+)\",\"\\\\2\",plink.diff.fst$Locus)\n\nplink.both.fst$Chrom<-apply(plink.both.fst,1,function(x){\n  chrom<-bmap[bmap$V2 %in% gsub(\"X(\\\\d+_\\\\d+)_\\\\w\",\"\\\\1\",x),\"V1\"]\n})\nplink.both.fst$Chrom<-factor(plink.both.fst$Chrom)\nplink.both.fst$Pos<-apply(plink.both.fst,1,function(x){\n  pos<-bmap[bmap$V2 %in% gsub(\"X(\\\\d+_\\\\d+)_\\\\w\",\"\\\\1\",x),\"V4\"]\n})\n\n#PLOTTING##\nlgs<-c(\"LG1\",\"LG2\",\"LG3\",\"LG4\",\"LG5\",\"LG6\",\"LG7\",\"LG8\",\"LG9\",\"LG10\",\"LG11\",\n       \"LG12\",\"LG13\",\"LG14\",\"LG15\",\"LG16\",\"LG17\",\"LG18\",\"LG19\",\"LG20\",\"LG21\",\n       \"LG22\")\nlgn<-seq(1,22)\nscaffs<-levels(as.factor(plink.both.fst[,\"Chrom\"]))\nscaffs[1:22]<-lgs\n\njpeg(\"sd-dd_Fst_subset.jpeg\",height=10,width=7.5,units=\"in\",res=300)\npar(mfrow=c(2,1),mar=c(2,2,2,2),oma=c(1,2,1,1))\nod<-fst.plot(plink.both.fst[!is.na(plink.both.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n             fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(-2,0.6),\n             groups=as.factor(scaffs[scaffs %in% levels(factor(plink.both.fst$Chrom[!is.na(plink.both.fst$Fst)]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(od[od$Chrom ==lgs[i],\"Pos\"]),y=-2.1,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(od[od$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Together\",3,cex=0.75)\nodb<-fst.plot(plink.diff.fst[!is.na(plink.diff.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(-1,0.3),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(plink.diff.fst[!is.na(plink.diff.fst),\"Chrom\"]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odb[odb$Chrom ==lgs[i],\"Pos\"]),y=-1.1,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odb[odb$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately\",3,cex=0.75)\ndev.off()\n\n##STATS\nplink.fst<-data.frame(Fst=as.numeric(c(plink.both.fst$Fst,plink.diff.fst$Fst)),\n  Analysis=c(rep(\"Together\",length(plink.both.fst$Fst)),rep(\"Separately\",length(plink.diff.fst$Fst))))\n\n##############################60 sdRAD and 60 ddRAD##################################\nd.ind.sub<-sample(d.ind,60,replace=F)\nsub.fsts.both<-do.call(\"rbind\",apply(both.sub,1,fst.one.vcf,group1=c(locus.info,o.ind),group2=c(locus.info,d.ind.sub),cov.thresh=0.5))\nsub.fsts.both$SNP<-paste(sub.fsts.both$Chrom,as.numeric(as.character(sub.fsts.both$Pos)),sep=\".\")\n\nd.share.sub<-d.share[,colnames(d.share) %in% c(locus.info,d.ind.sub)]\nsub.od.fst<-do.call(\"rbind\",apply(o.share,1,fst.two.vcf,vcf2=d.share.sub,match.index=\"SNP\",cov.thresh=0.5))\nsub.od.fst$SNP<-paste(sub.od.fst$Chrom,as.numeric(as.character(sub.od.fst$Pos)),sep=\".\")\n\npng(\"fsts_60ddrad60sdrad.png\",height=10,width=7.5,units=\"in\",res=300)\npar(mfrow=c(4,1),mar=c(2,2,2,2),oma=c(1,2,1,1))\n##Separate\nod<-fst.plot(sub.od.fst[!is.na(sub.od.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n             fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n             groups=as.factor(scaffs[scaffs %in% levels(factor(sub.od.fst$Chrom[!is.na(sub.od.fst$Fst)]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(od[od$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(od[od$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately\",3,cex=0.75)\nodc<-fst.plot(sub.od.fst[!is.na(sub.od.fst$Fst) & sub.od.fst$SNP %in% cov.pass,],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(sub.od.fst$Chrom[!is.na(sub.od.fst$Fst)& sub.od.fst$SNP %in% cov.pass]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odc[odc$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odc[odc$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately, Coverage Filter\",3,cex=0.75)\n\n##Together\nodb<-fst.plot(sub.fsts.both[!is.na(sub.fsts.both$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(sub.fsts.both[!is.na(sub.fsts.both$Fst),\"Chrom\"]))]))\nodb$Pos<-as.numeric(as.character(odb$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odb[odb$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odb[odb$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together\",3,cex=0.75)\nodbc<-fst.plot(sub.fsts.both[!is.na(sub.fsts.both$Fst) & sub.fsts.both$SNP %in% sep.cov.pass,],\n               ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), y.lim=c(0,1),\n               fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,\n               groups=as.factor(scaffs[scaffs %in% \n                                         levels(factor(sub.fsts.both[!is.na(sub.fsts.both$Fst) & sub.fsts.both$SNP %in% sep.cov.pass,\"Chrom\"]))]))\nodbc$Pos<-as.numeric(as.character(odbc$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odbc[odbc$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odbc[odbc$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together, Coverage Filter\",3,cex=0.75)\nmtext(expression(italic(F)[ST]),2,outer=T,cex=0.75)\ndev.off()\n\nfst.aov.dat<-data.frame(Fst=c(od$Fst,odb$Fst,odc$Fst,odbc$Fst),\n                        Type=c(rep(\"Alone\",nrow(od)),rep(\"Together\",nrow(odb)),rep(\"Alone\",nrow(odc)),rep(\"Together\",nrow(odbc))),\n                        Filtered=c(rep(\"Unfiltered\",nrow(od)),rep(\"Unfiltered\",nrow(odb)),rep(\"Filtered\",nrow(odc)),rep(\"Filtered\",nrow(odbc))))\nfst.aov<-aov(Fst~Type*Filtered,dat=fst.aov.dat)\n\n\n##############################60 ddRAD and 60 ddRAD##################################\nd.ind.sub1<-sample(d.ind,60,replace=F)\nd.ind.sub2<-sample(d.ind[!(d.ind %in% d.ind.sub1)],60,replace=F)\ndsub.fsts.both<-do.call(\"rbind\",apply(both.sub,1,fst.one.vcf,group1=c(locus.info,d.ind.sub2),group2=c(locus.info,d.ind.sub1),cov.thresh=0.5))\ndsub.fsts.both$SNP<-paste(dsub.fsts.both$Chrom,as.numeric(as.character(dsub.fsts.both$Pos)),sep=\".\")\n\nd.share.sub1<-d.share[,colnames(d.share) %in% c(locus.info,d.ind.sub1)]\nd.share.sub2<-d.share[,colnames(d.share) %in% c(locus.info,d.ind.sub2)]\ndsub.od.fst<-do.call(\"rbind\",apply(d.share.sub1,1,fst.two.vcf,vcf2=d.share.sub2,match.index=\"SNP\",cov.thresh=0.5))\ndsub.od.fst$SNP<-paste(dsub.od.fst$Chrom,as.numeric(as.character(dsub.od.fst$Pos)),sep=\".\")\n\npng(\"fsts_60ddrad60sdrad.png\",height=10,width=7.5,units=\"in\",res=300)\npar(mfrow=c(4,1),mar=c(2,2,2,2),oma=c(1,2,1,1))\n##Separate\nod<-fst.plot(dsub.od.fst[!is.na(dsub.od.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n             fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n             groups=as.factor(scaffs[scaffs %in% levels(factor(dsub.od.fst$Chrom[!is.na(dsub.od.fst$Fst)]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(od[od$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(od[od$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately\",3,cex=0.75)\nodc<-fst.plot(dsub.od.fst[!is.na(dsub.od.fst$Fst) & dsub.od.fst$SNP %in% cov.pass,],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(dsub.od.fst$Chrom[!is.na(dsub.od.fst$Fst)& dsub.od.fst$SNP %in% cov.pass]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odc[odc$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odc[odc$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately, Coverage Filter\",3,cex=0.75)\n\n##Together\nodb<-fst.plot(dsub.fsts.both[!is.na(dsub.fsts.both$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(dsub.fsts.both[!is.na(dsub.fsts.both$Fst),\"Chrom\"]))]))\nodb$Pos<-as.numeric(as.character(odb$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odb[odb$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odb[odb$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together\",3,cex=0.75)\nodbc<-fst.plot(dsub.fsts.both[!is.na(dsub.fsts.both$Fst) & dsub.fsts.both$SNP %in% sep.cov.pass,],\n               ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), y.lim=c(0,1),\n               fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,\n               groups=as.factor(scaffs[scaffs %in% \n                                         levels(factor(dsub.fsts.both[!is.na(dsub.fsts.both$Fst) & dsub.fsts.both$SNP %in% sep.cov.pass,\"Chrom\"]))]))\nodbc$Pos<-as.numeric(as.character(odbc$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(odbc[odbc$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(odbc[odbc$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together, Coverage Filter\",3,cex=0.75)\nmtext(expression(italic(F)[ST]),2,outer=T,cex=0.75)\ndev.off()\n\n\n\nfst.aov.dat<-data.frame(Fst=c(od$Fst,odb$Fst,odc$Fst,odbc$Fst),\n                        Type=c(rep(\"Alone\",nrow(od)),rep(\"Together\",nrow(odb)),rep(\"Alone\",nrow(odc)),rep(\"Together\",nrow(odbc))),\n                        Filtered=c(rep(\"Unfiltered\",nrow(od)),rep(\"Unfiltered\",nrow(odb)),rep(\"Filtered\",nrow(odc)),rep(\"Filtered\",nrow(odbc))))\nfst.aov<-aov(Fst~Type*Filtered,dat=fst.aov.dat)\n\n##############################THREE FST COMPARISONS##################################\npng(\"All3Fsts.png\",height=10,width=7.5,units=\"in\",res=300)\npar(mfrow=c(4,3),mar=c(2,1.5,2,1),oma=c(1,2,1,0.5))\n##ROW 1: Separate\n####All sdRAD vs all ddRAD\na.od<-fst.plot(od.fst[!is.na(od.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n             fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n             groups=as.factor(scaffs[scaffs %in% levels(factor(od.fst$Chrom[!is.na(od.fst$Fst)]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(a.od[a.od$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(a.od[a.od$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"Full Dataset\",3,cex=0.75,line=1)\n\n####sdRAD and 60 ddRAD\nsd.od<-fst.plot(sub.od.fst[!is.na(sub.od.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n                fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n                groups=as.factor(scaffs[scaffs %in% levels(factor(sub.od.fst$Chrom[!is.na(sub.od.fst$Fst)]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(sd.od[sd.od$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(sd.od[sd.od$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately\",3,cex=0.75)\nmtext(\"sdRAD and 60 ddRAD Individuals\",3,cex=0.75, line = 1)\n\n####60 ddRAD and 60 ddRAD\ndd.od<-fst.plot(dsub.od.fst[!is.na(dsub.od.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n                fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n                groups=as.factor(scaffs[scaffs %in% levels(factor(dsub.od.fst$Chrom[!is.na(dsub.od.fst$Fst)]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(dd.od[dd.od$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(dd.od[dd.od$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"60 ddRAD and 60 ddRAD Individuals\",3,cex=0.75, line = 1)\n\n#####ROW 2\n####All sdRAD vs all ddRAD\na.odc<-fst.plot(od.fst[!is.na(od.fst$Fst) & od.fst$SNP %in% cov.pass,],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(od.fst$Chrom[!is.na(od.fst$Fst)& od.fst$SNP %in% cov.pass]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(a.odc[a.odc$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(a.odc[a.odc$Chrom ==lgs[i],\"Pos\"])\n}\n\n####sdRAD vs 60 ddRAD\nsd.odc<-fst.plot(sub.od.fst[!is.na(sub.od.fst$Fst) & sub.od.fst$SNP %in% cov.pass,],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n                 fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n                 groups=as.factor(scaffs[scaffs %in% levels(factor(sub.od.fst$Chrom[!is.na(sub.od.fst$Fst)& sub.od.fst$SNP %in% cov.pass]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(sd.odc[sd.odc$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(sd.odc[sd.odc$Chrom ==lgs[i],\"Pos\"])\n}\nmtext(\"sdRAD-ddRAD Analyzed Separately, Coverage Filter\",3,cex=0.75)\n\n\n####60 ddRAD and 60 ddRAD\ndd.odc<-fst.plot(dsub.od.fst[!is.na(dsub.od.fst$Fst) & dsub.od.fst$SNP %in% cov.pass,],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n                 fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n                 groups=as.factor(scaffs[scaffs %in% levels(factor(dsub.od.fst$Chrom[!is.na(dsub.od.fst$Fst)& dsub.od.fst$SNP %in% cov.pass]))]))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(dd.odc[dd.odc$Chrom ==lgs[i],\"Pos\"]),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(dd.odc[dd.odc$Chrom ==lgs[i],\"Pos\"])\n}\n\n\n\n#####ROW 3: Together\n####All sdRAD vs all ddRAD\na.odb<-fst.plot(od.both.fst[!is.na(od.both.fst$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n              fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n              groups=as.factor(scaffs[scaffs %in% levels(factor(od.both.fst[!is.na(od.both.fst$Fst),\"Chrom\"]))]))\na.odb$Pos<-as.numeric(as.character(a.odb$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(a.odb[a.odb$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(a.odb[a.odb$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\n\n####All sdRAD vs 60 ddRAD\nsd.odb<-fst.plot(sub.fsts.both[!is.na(sub.fsts.both$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n                 fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n                 groups=as.factor(scaffs[scaffs %in% levels(factor(sub.fsts.both[!is.na(sub.fsts.both$Fst),\"Chrom\"]))]))\nsd.odb$Pos<-as.numeric(as.character(sd.odb$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(sd.odb[sd.odb$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(sd.odb[sd.odb$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together\",3,cex=0.75)\n\n####60 ddRAD and 60 ddRAD\ndd.odb<-fst.plot(dsub.fsts.both[!is.na(dsub.fsts.both$Fst),],ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), \n                 fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,y.lim=c(0,1),\n                 groups=as.factor(scaffs[scaffs %in% levels(factor(dsub.fsts.both[!is.na(dsub.fsts.both$Fst),\"Chrom\"]))]))\ndd.odb$Pos<-as.numeric(as.character(dd.odb$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(dd.odb[dd.odb$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(dd.odb[dd.odb$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\n\n\n#####ROW 4: Together\n####All sdRAD vs all ddRAD\na.odbc<-fst.plot(od.both.fst[!is.na(od.both.fst$Fst) & od.both.fst$SNP %in% sep.cov.pass,],\n               ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), y.lim=c(0,1),\n               fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,\n               groups=as.factor(scaffs[scaffs %in% \n                                         levels(factor(od.both.fst[!is.na(od.both.fst$Fst) & od.both.fst$SNP %in% sep.cov.pass,\"Chrom\"]))]))\na.odbc$Pos<-as.numeric(as.character(a.odbc$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(a.odbc[a.odbc$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(a.odbc[a.odbc$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\n\n####All sdRAD vs 60 ddRAD\nsd.odbc<-fst.plot(sub.fsts.both[!is.na(sub.fsts.both$Fst) & sub.fsts.both$SNP %in% sep.cov.pass,],\n               ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), y.lim=c(0,1),\n               fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,\n               groups=as.factor(scaffs[scaffs %in% \n                                         levels(factor(sub.fsts.both[!is.na(sub.fsts.both$Fst) & sub.fsts.both$SNP %in% sep.cov.pass,\"Chrom\"]))]))\nsd.odbc$Pos<-as.numeric(as.character(sd.odbc$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(sd.odbc[sd.odbc$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(sd.odbc[sd.odbc$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(\"sdRAD-ddRAD Analyzed Together, Coverage Filter\",3,cex=0.75)\n\n###60 ddRAD vs 60 ddRAD\ndd.odbc<-fst.plot(dsub.fsts.both[!is.na(dsub.fsts.both$Fst) & dsub.fsts.both$SNP %in% sep.cov.pass,],\n               ci.dat=c(-10,10),sig.col=c(\"black\",\"black\"), y.lim=c(0,1),\n               fst.name=\"Fst\",chrom.name=\"Chrom\",bp.name=\"Pos\",axis.size=1,\n               groups=as.factor(scaffs[scaffs %in% \n                                         levels(factor(dsub.fsts.both[!is.na(dsub.fsts.both$Fst) & dsub.fsts.both$SNP %in% sep.cov.pass,\"Chrom\"]))]))\ndd.odbc$Pos<-as.numeric(as.character(dd.odbc$Pos))\nlast<-0\nfor(i in 1:length(lgs)){\n  text(x=mean(dd.odbc[dd.odbc$Chrom ==lgs[i],\"Pos\"],na.rm=T),y=-0.05,\n       labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=1)\n  last<-max(dd.odbc[dd.odbc$Chrom ==lgs[i],\"Pos\"],na.rm = T)\n}\nmtext(expression(italic(F)[ST]),2,outer=T,cex=0.75)\nmtext(\"Linkage Group\",1,outer=T,cex=0.75)\ndev.off()\n\n\nfst.aov.dat<-data.frame(Fst=c(a.od$Fst,sd.od$Fst,dd.od$Fst,a.odb$Fst,sd.odb$Fst,dd.odb$Fst,a.odc$Fst,\n                              sd.odc$Fst,dd.odc$Fst,a.odbc$Fst,sd.odbc$Fst,dd.odbc$Fst),\n                        Type=c(rep(\"All\",nrow(a.od)),rep(\"Each60\",nrow(sd.od)),rep(\"ddRAD\",nrow(dd.od)),\n                               rep(\"All\",nrow(a.odb)),rep(\"Each60\",nrow(sd.odb)),rep(\"ddRAD\",nrow(dd.odb)),\n                               rep(\"All\",nrow(a.odc)),rep(\"Each60\",nrow(sd.odc)),rep(\"ddRAD\",nrow(dd.odc)),\n                               rep(\"All\",nrow(a.odbc)),rep(\"Each60\",nrow(sd.odbc)),rep(\"ddRAD\",nrow(dd.odbc))),\n                        Filtered=c(rep(\"Unfiltered\",(nrow(a.od)+nrow(sd.od)+nrow(dd.od))),\n                                   rep(\"Unfiltered\",(nrow(a.odb)+nrow(sd.odb)+nrow(dd.odb))),\n                                   rep(\"Filtered\",(nrow(a.odc)+nrow(sd.odc)+nrow(dd.odc))),\n                                   rep(\"Filtered\",(nrow(a.odbc)+nrow(sd.odbc)+nrow(dd.odbc)))))\nfst.aov<-aov(Fst~Type*Filtered,dat=fst.aov.dat)\n\n##############################DRAD DIFFERENT PLATES##################################\n\n#d.cov<-do.call(\"rbind\",apply(drad,1,vcf.cov.loc,subset=d.ind))\n#d.cov$SNP<-paste(d.cov$Chrom,d.cov$Locus,d.cov$Pos,sep=\".\")\n#d.cov$AvgCovRatio[d.cov$AvgCovRatio==\"Inf\"]<-0\nd.keep<-d.cov[d.cov$PropMissing>0.5,]\nplate1<-unlist(as.list(read.delim(\"../plate1.txt\",stringsAsFactors = F)))\nplate2<-unlist(as.list(read.delim(\"../plate2.txt\",stringsAsFactors = F)))\nplate3<-unlist(as.list(read.delim(\"../plate3.txt\",stringsAsFactors = F)))\nplate4<-unlist(as.list(read.delim(\"../plate4.txt\",stringsAsFactors = F)))\n\nd1<-cbind(drad[drad$SNP %in% d.keep$SNP,1:9],drad$SNP[drad$SNP %in% d.keep$SNP],drad[drad$SNP %in% d.keep$SNP,colnames(drad) %in% plate1])\nd2<-cbind(drad[drad$SNP %in% d.keep$SNP,1:9],drad$SNP[drad$SNP %in% d.keep$SNP],drad[drad$SNP %in% d.keep$SNP,colnames(drad) %in% plate2])\nd3<-cbind(drad[drad$SNP %in% d.keep$SNP,1:9],drad$SNP[drad$SNP %in% d.keep$SNP],drad[drad$SNP %in% d.keep$SNP,colnames(drad) %in% plate3])\nd4<-cbind(drad[drad$SNP %in% d.keep$SNP,1:9],drad$SNP[drad$SNP %in% d.keep$SNP],drad[drad$SNP %in% d.keep$SNP,colnames(drad) %in% plate4])\np1<-grep(\"sample\",colnames(d1))\np2<-grep(\"sample\",colnames(d2))\np3<-grep(\"sample\",colnames(d3))\np4<-grep(\"sample\",colnames(d4))\nd1.cov<-do.call(\"rbind\",apply(d1,1,vcf.cov.loc,subset=p1))\nd2.cov<-do.call(\"rbind\",apply(d2,1,vcf.cov.loc,subset=p2))\nd3.cov<-do.call(\"rbind\",apply(d3,1,vcf.cov.loc,subset=p3))\nd4.cov<-do.call(\"rbind\",apply(d4,1,vcf.cov.loc,subset=p4))\nd1.cov$Plate<-\"plate1\"\nd2.cov$Plate<-\"plate2\"\nd3.cov$Plate<-\"plate3\"\nd4.cov$Plate<-\"plate4\"\ndcomp<-rbind(d1.cov,d2.cov,d3.cov,d4.cov)\ndcomp$AvgCovRatio[dcomp$AvgCovRatio==\"Inf\"]<-0\nsummary(aov(dcomp$PropHet~dcomp$Plate))\nTukeyHSD(aov(dcomp$PropHet~dcomp$Plate))\n\nsummary(aov(dcomp$AvgCovTotal~dcomp$Plate))\nTukeyHSD(aov(dcomp$AvgCovTotal~dcomp$Plate))\n\nsummary(aov(dcomp$AvgCovRatio~dcomp$Plate))\nTukeyHSD(aov(dcomp$AvgCovRatio~dcomp$Plate))\ndrl<-lm(dcomp$AvgCovRatio~dcomp$Locus*dcomp$Plate)\nplot(dcomp$AvgCovRatio~dcomp$Locus,col=alpha(as.numeric(as.factor(dcomp$Plate)),0.5),pch=19)\nlegend(\"top\",ncol=2,levels(factor(dcomp$Plate)),col=alpha(as.numeric(as.factor(levels(as.factor(dcomp$Plate)))),0.5),pch=19,bty='n')\nsummary(aov(dcomp$CovVariance~dcomp$Plate))\nTukeyHSD(aov(dcomp$CovVariance~dcomp$Plate))\ndvl<-lm(dcomp$CovVariance~dcomp$Locus*dcomp$Plate)\nplot(dcomp$CovVariance~dcomp$Locus,col=alpha(as.numeric(as.factor(dcomp$Plate)),0.5),pch=19)\nlegend(\"top\",ncol=2,levels(factor(dcomp$Plate)),col=alpha(as.numeric(as.factor(levels(as.factor(dcomp$Plate)))),0.5),pch=19,bty='n')\n\nsummary(aov(dcomp$PropMissing~dcomp$Plate))\nTukeyHSD(aov(dcomp$PropMissing~dcomp$Plate))\n\n###############################ALLELE FREQUENCIES#####################################\nboth.afs<-do.call(\"rbind\",apply(both,1,afs.vcf))\n\n############################ORIGINAL INVESTIGATION###################################\nsetwd(\"E:/ubuntushare/SCA/results/biallelic/both_datasets/\")\nsummary<-read.delim(\"gwsca_summary_datasets.txt\")\n\nddRAD<-summary[summary$Pop==\"ddRAD\",]\noRAD<-summary[summary$Pop==\"oRAD\",]\ncolB<-c(rep(\"dd\",nrow(ddRAD)),rep(\"o\",nrow(oRAD)))\ncolA<-c(ddRAD$Allele1Freq,oRAD$Allele1Freq)\ndt<-data.frame(colA,colB)\n\npng(\"AlleleFreq_twotypes.png\",height=7,width=7,units=\"in\",res=300)\nggplot(dt, aes(x = colA, fill = colB)) + \n  geom_histogram(col = \"black\", alpha = 0.5, \n                 position = \"identity\") +\n  scale_fill_discrete(name = \"Library Type\",\n                      labels = c(\"ddRAD\",\"sdRAD\"))\ndev.off()\n\nfst<-read.delim(\"gwsca_fsts_datasets.txt\")\nmean(fst$ddRAD.oRAD[fst$ddRAD.oRAD>=0]) #0.0616421\npng(\"DDvsSD_allFsts.png\",height=7,width=7,units=\"in\",res=300)\nplot(fst$ddRAD.oRAD[fst$ddRAD.oRAD>=0], xaxt='n',ylab=\"Fst\",pch=19) #0.0616421\ndev.off()\n\n\n#compare the two datasets\ngw.ds.fst<-read.delim(\"gwsca_fsts_datasets.txt\")\ngw.ds.sum<-read.delim(\"gwsca_summary_datasets.txt\")\ngw.ds.fst$Locus<-paste(gw.ds.fst$Chrom,gw.ds.fst$Pos,sep=\".\")\ngw.ds.sum$Locus<-paste(gw.ds.sum$Chrom,gw.ds.sum$Pos,sep=\".\")\ngw.ds.sum<-gw.ds.sum[!is.na(gw.ds.sum$AA),]\ngw.ds.sum$AAexp<-gw.ds.sum$Allele1Freq*gw.ds.sum$Allele1Freq\ngw.ds.sum$aaexp<-gw.ds.sum$Allele2Freq*gw.ds.sum$Allele2Freq\ngw.ds.sum$Aaexp<-1-gw.ds.sum$aaexp-gw.ds.sum$AAexp\ngw.ds.sum$chi<-(((gw.ds.sum$AA-gw.ds.sum$AAexp)^2)/gw.ds.sum$AAexp)+\n\t(((gw.ds.sum$Aa-gw.ds.sum$Aaexp)^2)/gw.ds.sum$Aaexp)+\n\t(((gw.ds.sum$aa-gw.ds.sum$aaexp)^2)/gw.ds.sum$aaexp)\ngw.ds.sum$chi.result<-1-pchisq(gw.ds.sum$chi,1) #biallelic, df=1\nsum.sum<-tapply(gw.ds.sum$N,gw.ds.sum$Locus,sum)\nsum.sum<-sum.sum[as.numeric(sum.sum) > 87]#total N is 58*2<-this is 75%\npsum.prune<-gw.ds.sum[gw.ds.sum$Locus %in% names(sum.sum),]\npsum.list<-split(psum.prune, psum.prune$Pop)\ndr.n<-psum.list$ddRAD[psum.list$ddRAD$N > 383,]\nor.n<-psum.list$oRAD[psum.list$oRAD$N>58,]\n#Now prune based on allele frequencies\ndr.n<-dr.n[dr.n$Allele1Freq > 0.05 & dr.n$Allele1Freq < 0.95,]\nor.n<-or.n[or.n$Allele1Freq > 0.05 & or.n$Allele1Freq < 0.95,]\n#comparisons\nds.prune<-gw.ds.fst[gw.ds.fst$Locus %in% dr.n$Locus &\n\tgw.ds.fst$Locus %in% or.n$Locus, ]\nds.prune<-ds.prune[ds.prune$ddRAD.oRAD>0,]\n\noutliers<-ds.prune[ds.prune$ddRAD.oRAD > 0.3,\"Locus\"]\nout.sum<-gw.ds.sum[gw.ds.sum$Locus %in% outliers,]\nout.sum<-out.sum[out.sum$Pop == \"ddRAD\" | out.sum$Pop == \"oRAD\",]\nho.diff<-tapply(out.sum$Ho,out.sum$Locus,function(x){ diff<-x[2]-x[1] })\nhs.diff<-tapply(out.sum$Hs,out.sum$Locus,function(x){ diff<-x[2]-x[1] })\n\npng(\"ddRADvoRAD.png\",height=7,width=7,units=\"in\",res=300)\nplot(ds.prune$ddRAD.oRAD,xlab=\"\",ylab=\"Fst\")\ndev.off()\n\n\n",
    "created" : 1484186281135.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "437240626",
    "id" : "F2F92825",
    "lastKnownWriteTime" : 1483482532,
    "last_content_update" : 1483482532,
    "path" : "B:/ubuntushare/SCA/scripts/compare_ddRADsdRAD.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}