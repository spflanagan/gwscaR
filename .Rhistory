<<<<<<< HEAD
hd$p_0<- 1 - pchisq(hd$LRT0, df = 1)
hd$p_2<- 1 - pchisq(hd$LRT2, df = 2)
hd$p_3<- 1 - pchisq(hd$LRT3, df = 1)
hd$bh_0<-p.adjust(hd$p_0,method="BH")
hd$bh_2<-p.adjust(hd$p_2,method="BH")
hd$bh_3<-p.adjust(hd$p_3,method="BH")
hd$lnp0<-log(hd$p_0,base=10)*-1
hd$lnp3<-log(hd$p_3,base=10)*-1
hd0.sig<-hd[hd$bh_0<=0.05,]
hd2.sig<-hd[hd$bh_2<=0.05,]
hd3.sig<-hd[hd$bh_3<=0.05,]
hd0.top1<-hd[order(hd$LRT0),]
hd0.top1<-hd0.top1[round(nrow(hd0.top1)*0.99),"LRT0"]
hd0.out1<-hd[hd$LRT0 >= hd0.top1,]
hd3.top1<-hd[order(hd$LRT3),]
hd3.top1<-hd3.top1[round(nrow(hd3.top1)*0.99),"LRT3"]
hd3.out1<-hd[hd$LRT3 >= hd3.top1,]
fm.out1$CompLoc<-paste(fm.out1$Chrom,fm.out1$Pos,sep=".")
mo.out1$CompLoc<-paste(mo.out1$Chrom,mo.out1$Pos,sep=".")
fm.plot$CompLoc<-paste(fm.plot$Chrom,fm.plot$Pos,sep=".")
mo.plot$CompLoc<-paste(mo.plot$Chrom,mo.plot$Pos,sep=".")
gw.sum$CompLoc<-paste(gw.sum$Chrom,gw.sum$Pos,sep=".")
fm.both1<-fm.out1[fm.out1$SNP %in% hd0.out1$Locus,"SNP"]
mo.both1<-mo.out1[mo.out1$SNP %in% hd3.out1$Locus, "SNP"]
fm.fst$Locus<-gsub("(\\d+)\\.(\\d+)\\.(\\d+)", "\\1.\\3",fm.fst$SNP)
mo.fst$Locus<-gsub("(\\d+)\\.(\\d+)\\.(\\d+)", "\\1.\\3",mo.fst$SNP)
fm.both.out<-fm.fst[fm.fst$Locus %in% hd0.sig$Locus & fm.fst$Chi.p.adj<=0.05,"Locus"]
mo.both.out<-mo.fst[mo.fst$Locus %in% hd3.sig$Locus & mo.fst$Chi.p.adj<=0.05, "Locus"]
fm.sig<-fm.sig[fm.sig$Chi.p.adj<=0.05,]
fm.sig$RADloc<-gsub("(\\w+.*\\.\\d+)\\.\\d+","\\1",fm.sig$SNP)
fm.sig$comploc<-gsub("(\\w+.*)\\.\\d+(\\.\\d+)","\\1\\2",fm.sig$SNP)
mo.sig<-mo.sig[mo.sig$Chi.p.adj<=0.05,]
mo.sig$RADloc<-gsub("(\\w+.*\\.\\d+)\\.\\d+","\\1",mo.sig$SNP)
fmmo<-fm.sig[fm.sig$SNP %in% mo.sig$SNP,]
fm.fstlrt<-fm.fst[fm.fst$Locus %in% hd0.sig$Locus & fm.fst$Chi.p.adj<=0.05,]
fm.fstlrt$RADloc<-gsub("(\\w+.*\\.\\d+)\\.\\d+","\\1",fm.fstlrt$SNP)
fm.sig.un<-fm.sig[!(fm.sig$SNP %in% fmmo$SNP) & !(fm.sig$SNP %in% fm.fstlrt$SNP),]
mo.sig.un<-mo.sig[!(mo.sig$SNP %in% fmmo$SNP),]
fml.un<-hd0.sig[!(hd0.sig$Locus %in% fm.fst$Locus),]
shared.sig<-fm.sig[fm.sig$SNP %in% mo.sig$SNP & fm.sig$comploc %in% hd0.sig$Locus,]
par(mfrow=c(2,1),oma=c(1,1,0,0),mar=c(1,1,1,0),mgp=c(3,0.5,0), cex=1.5)
mo<-fst.plot(mo.plot, fst.name="MOM.FEM",
chrom.name="Chrom", axis.size=0,bp.name="Pos",groups=scaffs,group.boundaries = scaff.starts)
#mo<-fst.plot(mo.plot, ci.dat=c(mo.top1,0),fst.name="MOM.FEM",
#             chrom.name="Chrom", axis.size=0,bp.name="Pos",
#             sig.col=c("black","black"),groups=as.factor(scaffs[scaffs %in% levels(factor(mo.plot$Chrom))]))
points(mo$Pos[mo$Locus %in% mo.sig$SNP], #mo fst
mo$MOM.FEM[mo$Locus %in% mo.sig$SNP],
col="green4",pch=19,cex=0.75)
#points(mo$Pos[mo$CompLoc %in% mo.both.out[substr(mo.both.out,1,2)=="LG"]],
#       mo$MOM.FEM[mo$CompLoc %in% mo.both.out[substr(mo.both.out,1,2)=="LG"]],
#       col="green2",pch=5,cex=1)#none of these
points(mo$Pos[mo$Locus %in% fmmo$SNP], #fm-mo fst
mo$MOM.FEM[mo$Locus %in% fmmo$SNP],
col="royalblue4",pch=8)
points(mo$Pos[mo$Locus %in% shared.sig$SNP], #shared in all
mo$MOM.FEM[mo$Locus %in% shared.sig$SNP],
col="dodgerblue1",pch=5)
#clip(0,max(mo$Pos),-1,1)
#abline(h=mo.top1,col="darkorchid1",lwd=1.3)
axis(2,at=seq(0,0.2,0.05),pos=0,las=1,cex.axis=0.75)
legend("top","Females-Inferred Mothers",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(mo[mo$Chrom ==lgs[i],"Pos"]),y=-0.004,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(mo[mo$Chrom ==lgs[i],"Pos"])
}
fm<-fst.plot(fm.plot, fst.name="FEM.MAL",
chrom.name="Chrom", axis.size=0,bp.name="Pos",groups=scaffs,group.boundaries = scaff.starts)
#fm<-fst.plot(fm.plot, ci.dat=c(fm.top1,0),fst.name="FEM.MAL",
#             chrom.name="Chrom", axis.size=0,bp.name="Pos",
#             sig.col=c("black","black"),groups=as.factor(scaffs[scaffs %in% levels(factor(fm.plot$Chrom))]))
points(fm$Pos[fm$Locus %in% fm.sig$SNP], #fm fst sig
fm$FEM.MAL[fm$Locus %in% fm.sig$SNP],
col="orchid1",pch=19,cex=0.75)
points(fm$Pos[fm$Locus %in% fmmo$SNP], #fm-mo fst sig
fm$FEM.MAL[fm$Locus %in% fmmo$SNP],
col="royalblue4",pch=8,cex=1)
points(fm$Pos[fm$Locus %in% fm.fstlrt$SNP], #fm fst - fm lrt
fm$FEM.MAL[fm$Locus %in% fm.fstlrt$SNP],
col="darkorchid4",pch=5,cex=1)
points(fm$Pos[fm$Locus %in% shared.sig$SNP], #shared in all
fm$FEM.MAL[fm$Locus %in% shared.sig$SNP],
col="dodgerblue1",pch=5)
#clip(0,max(fm$Pos),-1,1)
#abline(h=fm.top1,col="green3",lwd=1.3)
axis(2,at=seq(0,0.2,0.1),pos=0,las=1,cex.axis=0.75)
legend("top","Male-Female",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(fm[fm$Chrom ==lgs[i],"Pos"]),y=-0.004,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(fm[fm$Chrom ==lgs[i],"Pos"])
}
mtext("Linkage Group", 1, outer=T, cex=1)
mtext(expression(italic(F)[italic(ST)]), 2, outer=T, cex=1,las=0)
par(fig = c(0, 1, 0, 1), oma=c(2,1,0,1), mar = c(0, 0, 0, 0), new = TRUE,
cex=1)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top",col=c("orchid1","green4","royalblue4","darkorchid4","dodgerblue1"),
pch=c(19,19,8,5,5),text.col="black",
c("Viability Selection","Sexual Selection",expression(Shared~italic(F)[ST]),
"Shared with LRT","Shared in All"),
bg="white",ncol=5,box.lty=0)
pdf("fst.selection.episodes_redo_all_updatedlgs.pdf",height=7.66666,width=11.5)
par(mfrow=c(2,1),oma=c(1,1,0,0),mar=c(1,1,1,0),mgp=c(3,0.5,0), cex=1.5)
mo<-fst.plot(mo.plot, fst.name="MOM.FEM",
chrom.name="Chrom", axis.size=0,bp.name="Pos",groups=scaffs,group.boundaries = scaff.starts)
#mo<-fst.plot(mo.plot, ci.dat=c(mo.top1,0),fst.name="MOM.FEM",
#             chrom.name="Chrom", axis.size=0,bp.name="Pos",
#             sig.col=c("black","black"),groups=as.factor(scaffs[scaffs %in% levels(factor(mo.plot$Chrom))]))
points(mo$Pos[mo$Locus %in% mo.sig$SNP], #mo fst
mo$MOM.FEM[mo$Locus %in% mo.sig$SNP],
col="green4",pch=19,cex=0.75)
#points(mo$Pos[mo$CompLoc %in% mo.both.out[substr(mo.both.out,1,2)=="LG"]],
#       mo$MOM.FEM[mo$CompLoc %in% mo.both.out[substr(mo.both.out,1,2)=="LG"]],
#       col="green2",pch=5,cex=1)#none of these
points(mo$Pos[mo$Locus %in% fmmo$SNP], #fm-mo fst
mo$MOM.FEM[mo$Locus %in% fmmo$SNP],
col="royalblue4",pch=8)
points(mo$Pos[mo$Locus %in% shared.sig$SNP], #shared in all
mo$MOM.FEM[mo$Locus %in% shared.sig$SNP],
col="dodgerblue1",pch=5)
#clip(0,max(mo$Pos),-1,1)
#abline(h=mo.top1,col="darkorchid1",lwd=1.3)
axis(2,at=seq(0,0.2,0.05),pos=0,las=1,cex.axis=0.75)
legend("top","Females-Inferred Mothers",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(mo[mo$Chrom ==lgs[i],"Pos"]),y=-0.004,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(mo[mo$Chrom ==lgs[i],"Pos"])
}
fm<-fst.plot(fm.plot, fst.name="FEM.MAL",
chrom.name="Chrom", axis.size=0,bp.name="Pos",groups=scaffs,group.boundaries = scaff.starts)
#fm<-fst.plot(fm.plot, ci.dat=c(fm.top1,0),fst.name="FEM.MAL",
#             chrom.name="Chrom", axis.size=0,bp.name="Pos",
#             sig.col=c("black","black"),groups=as.factor(scaffs[scaffs %in% levels(factor(fm.plot$Chrom))]))
points(fm$Pos[fm$Locus %in% fm.sig$SNP], #fm fst sig
fm$FEM.MAL[fm$Locus %in% fm.sig$SNP],
col="orchid1",pch=19,cex=0.75)
points(fm$Pos[fm$Locus %in% fmmo$SNP], #fm-mo fst sig
fm$FEM.MAL[fm$Locus %in% fmmo$SNP],
col="royalblue4",pch=8,cex=1)
points(fm$Pos[fm$Locus %in% fm.fstlrt$SNP], #fm fst - fm lrt
fm$FEM.MAL[fm$Locus %in% fm.fstlrt$SNP],
col="darkorchid4",pch=5,cex=1)
points(fm$Pos[fm$Locus %in% shared.sig$SNP], #shared in all
fm$FEM.MAL[fm$Locus %in% shared.sig$SNP],
col="dodgerblue1",pch=5)
#clip(0,max(fm$Pos),-1,1)
#abline(h=fm.top1,col="green3",lwd=1.3)
axis(2,at=seq(0,0.2,0.1),pos=0,las=1,cex.axis=0.75)
legend("top","Male-Female",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(fm[fm$Chrom ==lgs[i],"Pos"]),y=-0.004,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(fm[fm$Chrom ==lgs[i],"Pos"])
}
mtext("Linkage Group", 1, outer=T, cex=1)
mtext(expression(italic(F)[italic(ST)]), 2, outer=T, cex=1,las=0)
par(fig = c(0, 1, 0, 1), oma=c(2,1,0,1), mar = c(0, 0, 0, 0), new = TRUE,
cex=1)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top",col=c("orchid1","green4","royalblue4","darkorchid4","dodgerblue1"),
pch=c(19,19,8,5,5),text.col="black",
c("Viability Selection","Sexual Selection",expression(Shared~italic(F)[ST]),
"Shared with LRT","Shared in All"),
bg="white",ncol=5,box.lty=0)
dev.off()
getwd()
par(mfrow=c(2,1),oma=c(1,1,0,0),mar=c(1,1,1,0),mgp=c(3,0.5,0), cex=1.5)
hd3<-fst.plot(hd,fst.name="lnp3", chrom.name="chrom"
, axis.size=0,bp.name="pos",y.lim=c(0,7),
groups=scaffs,group.boundaries = scaff.starts)
#points(hd3[hd3$bh_3<=0.05,"pos"], #none are sig!
#	hd3[hd3$bh_3<=0.05,"lnp3"],
#	col="purple3",pch=19,cex=0.75)
#points(hd3[hd3$bh_3<=0.05 & hd3$Locus %in% mo.out1$CompLoc,"pos"],
#	hd3[hd3$bh_3<=0.05 & hd3$Locus %in% mo.out1$CompLoc,"lnp3"],
#	col="purple3",pch=5,cex=1)
axis(2,at=seq(0,15,5),pos=0,las=1,cex.axis=0.75)
legend("top","Successful Females-Adults",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(hd3[hd3$chrom ==lgs[i],"pos"]),y=-0.5,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(hd3[hd3$chrom ==lgs[i],"pos"])
}
hd0<-fst.plot(hd,fst.name="lnp0", chrom.name="chrom"
, axis.size=0,bp.name="pos",
groups=scaffs,group.boundaries = scaff.starts)
points(hd0[hd0$bh_0<=0.05,"pos"],
hd0[hd0$bh_0<=0.05,"lnp0"],
col="mediumorchid3",pch=19,cex=0.75)
points(hd0[hd0$Locus %in% fm.fstlrt$Locus,"pos"],
hd0[hd0$Locus %in% fm.fstlrt$Locus,"lnp0"],
col="darkorchid4",pch=5,cex=1)
points(hd0[hd0$Locus %in% shared.sig$comploc,"pos"],
hd0[hd0$Locus %in% shared.sig$comploc,"lnp0"],
col="dodgerblue1",pch=5,cex=1)
axis(2,at=seq(0,15,5),pos=0,las=1,cex.axis=0.75)
legend("top","Males-Females",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(hd0[hd0$chrom ==lgs[i],"pos"]),y=-0.5,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(hd0[hd0$chrom ==lgs[i],"pos"])
}
mtext("Linkage Group", 1, outer=T, cex=1)
mtext(expression(-log[10]~italic(p)), 2, outer=T, cex=1,las=0)
par(fig = c(0, 1, 0, 1), oma=c(2,1,0,1), mar = c(0, 0, 0, 0), new = TRUE,
cex=1)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top",col=c("orchid1","darkorchid4","dodgerblue1"),
pch=c(19,5,5),text.col="black",
c("Viability Selection",
expression(Shared~with~Males-Females~italic(F)[ST]),"Shared in All"),
bg="white",ncol=3,box.lty=0)
pdf("kelly_analysis_scaffolds_updatedlgs.pdf",height=7.66666,width=11.5)
par(mfrow=c(2,1),oma=c(1,1,0,0),mar=c(1,1,1,0),mgp=c(3,0.5,0), cex=1.5)
hd3<-fst.plot(hd,fst.name="lnp3", chrom.name="chrom"
, axis.size=0,bp.name="pos",y.lim=c(0,7),
groups=scaffs,group.boundaries = scaff.starts)
#points(hd3[hd3$bh_3<=0.05,"pos"], #none are sig!
#	hd3[hd3$bh_3<=0.05,"lnp3"],
#	col="purple3",pch=19,cex=0.75)
#points(hd3[hd3$bh_3<=0.05 & hd3$Locus %in% mo.out1$CompLoc,"pos"],
#	hd3[hd3$bh_3<=0.05 & hd3$Locus %in% mo.out1$CompLoc,"lnp3"],
#	col="purple3",pch=5,cex=1)
axis(2,at=seq(0,15,5),pos=0,las=1,cex.axis=0.75)
legend("top","Successful Females-Adults",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(hd3[hd3$chrom ==lgs[i],"pos"]),y=-0.5,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(hd3[hd3$chrom ==lgs[i],"pos"])
}
hd0<-fst.plot(hd,fst.name="lnp0", chrom.name="chrom"
, axis.size=0,bp.name="pos",
groups=scaffs,group.boundaries = scaff.starts)
points(hd0[hd0$bh_0<=0.05,"pos"],
hd0[hd0$bh_0<=0.05,"lnp0"],
col="mediumorchid3",pch=19,cex=0.75)
points(hd0[hd0$Locus %in% fm.fstlrt$Locus,"pos"],
hd0[hd0$Locus %in% fm.fstlrt$Locus,"lnp0"],
col="darkorchid4",pch=5,cex=1)
points(hd0[hd0$Locus %in% shared.sig$comploc,"pos"],
hd0[hd0$Locus %in% shared.sig$comploc,"lnp0"],
col="dodgerblue1",pch=5,cex=1)
axis(2,at=seq(0,15,5),pos=0,las=1,cex.axis=0.75)
legend("top","Males-Females",bty='n',cex=0.75,text.font=2)
last<-0
for(i in 1:length(lgs)){
text(x=mean(hd0[hd0$chrom ==lgs[i],"pos"]),y=-0.5,
labels=lgn[i], adj=1, xpd=TRUE,srt=90,cex=0.75)
last<-max(hd0[hd0$chrom ==lgs[i],"pos"])
}
mtext("Linkage Group", 1, outer=T, cex=1)
mtext(expression(-log[10]~italic(p)), 2, outer=T, cex=1,las=0)
par(fig = c(0, 1, 0, 1), oma=c(2,1,0,1), mar = c(0, 0, 0, 0), new = TRUE,
cex=1)
plot(0, 0, type = "n", bty = "n", xaxt = "n", yaxt = "n")
legend("top",col=c("orchid1","darkorchid4","dodgerblue1"),
pch=c(19,5,5),text.col="black",
c("Viability Selection",
expression(Shared~with~Males-Females~italic(F)[ST]),"Shared in All"),
bg="white",ncol=3,box.lty=0)
dev.off()
dev.off()
fst.plot(fm.plot, fst.name="FEM.MAL",
chrom.name="Chrom", axis.size=0.75,bp.name="Pos",groups=scaffs)
=======
}
displacement<-y.lim[1]-((y.lim[2]-y.lim[1])/30)
plot(c(x.min,x.max),y.lim,xlim=c(x.min,x.max),
ylim=y.lim, col=pt.col,
bty="n",type="n",	axes=F, xlab="", ylab="")
for(i in 1:nrow(rect.xs)){
if(i%%2 == 0) {
rect.color<-"white"
} else {
rect.color<-"gray75"
}
rect(rect.xs[i,1],y.lim[1],rect.xs[i,2],y.lim[2],
col=rect.color, border=NA)
if(print.names==T){
text(x=mean(rect.xs[i,]),
y=displacement,labels=rownames(rect.xs)[i],
adj=1,xpd=T,srt=45)
}
}
print("plotting points")
for(i in 1:length(all.scaff)){
points(all.scaff[[i]][,bp.name],
all.scaff[[i]][,fst.name],
pch=19, cex=0.5,col=pt.col,
xlim=c(x.min,x.max),ylim=y.lim)
if(!is.null(ci.dat)){
temp.sig<-all.scaff[[i]][all.scaff[[i]][,fst.name] >= ci.dat[1],]
points(temp.sig[,bp.name], temp.sig[,fst.name],
col=sig.col[1], pch=19, cex=0.5)
temp.sig<-all.scaff[[i]][all.scaff[[i]][,fst.name] <= ci.dat[2],]
points(temp.sig[,bp.name], temp.sig[,fst.name],
col=sig.col[2], pch=19, cex=0.5)
}
}
if(axis.size>0){
axis(2, at = seq(round(y.lim[1],2),round(y.lim[2],2),
round((y.lim[2]-y.lim[1])/2, digits=2)),
ylim =y.lim, pos=0,
labels=seq(round(y.lim[1],2),round(y.lim[2],2),
round((y.lim[2]-y.lim[1])/2, digits=2)),
las=1,tck = -0.01, xlab="", ylab="", cex.axis=axis.size)
}
xes<-do.call("rbind",all.scaff)
return(xes)
}
mo<-fst.plot(mo.plot, ci.dat=c(mo.top1,0),fst.name="MOM.FEM",
chrom.name="Chrom", axis.size=0,bp.name="Pos",
sig.col=c("black","black"),groups=as.factor(scaffs),group.boundaries = max.pos)
>>>>>>> 4a7fa21eb973fcda977437fb1c379d3f15e0522d
fst.plot<-function(fst.dat,ci.dat=NULL, sig.col=c("red","yellow"),pt.col="grey7",
fst.name="Fst", chrom.name="Chrom", bp.name="BP",axis.size=0.5,
scaffold.order=NULL,groups=NULL,print.names=FALSE,y.lim=NULL,
group.boundaries=NULL){
if(!is.null(scaffold.order)){
scaff.ord<-scaffold.order$component_id
lgs<-scaffold.order$object
} else{
if(!is.null(group.boundaries)){
scaff.ord<-levels(factor(group.boundaries[,1]))
lgs<-scaff.ord
}else{
scaff.ord<-levels(factor(fst.dat[,chrom.name]))
lgs<-scaff.ord
}
}
if(!is.null(groups)){
lgs<-groups
scaff.ord<-groups
}
fst.dat[,fst.name]<-as.numeric(as.character(fst.dat[,fst.name]))
these.scaffs<-scaff.ord[scaff.ord %in% factor(fst.dat[,chrom.name])]
all.scaff<-split(fst.dat, factor(fst.dat[,chrom.name]))
group.boundaries<-group.boundaries[scaff.ord,]
last.max<-0
rect.xs<-NULL
addition.values<-0
xlist<-NULL
#set up the rectangles
for(i in 1:length(scaff.ord)){
if(is.null(group.boundaries)){
new.max<-max(last.max+nrow(all.scaff[[scaff.ord[i]]]))
}else{
new.max<-as.numeric(group.boundaries[scaff.ord[i],2])+as.numeric(last.max)
}
rect.xs<-rbind(rect.xs,c(last.max, new.max))
rownames(rect.xs)[i]<-scaff.ord[i]
addition.values<-c(addition.values, new.max)
last.max<-new.max
}
rownames(rect.xs)<-scaff.ord
for(i in 1:length(all.scaff)){
if(is.null(group.boundaries)){
#then this is done by relative position only
all.scaff[[i]]<-all.scaff[[i]][order(all.scaff[[i]][,bp.name]),]
all.scaff[[i]][,bp.name]<-
seq(rect.xs[rownames(rect.xs) %in% names(all.scaff)[i],1]+1,rect.xs[rownames(rect.xs) %in% names(all.scaff)[i],1]+nrow(all.scaff[[i]]),1)
}else{
#then it takes genome space into account
all.scaff[[i]]<-
all.scaff[[i]][order(all.scaff[[i]][,bp.name]),]
all.scaff[[i]][,bp.name]<-
as.numeric(rect.xs[rownames(rect.xs) %in% names(all.scaff)[i],1])+as.numeric(all.scaff[[i]][,bp.name])
}
}
#change BP to plot
x.max<-max(rect.xs)
x.min<-min(rect.xs)
if(is.null(y.lim)){
y.max<-max(fst.dat[,fst.name])+0.1*max(fst.dat[,fst.name])
y.min<-min(fst.dat[,fst.name])-0.1*min(fst.dat[,fst.name])
if(min(fst.dat[,fst.name]) < 0) {
y.min<-min(fst.dat[,fst.name]) - 0.1*min(fst.dat[,fst.name])
} else {
y.min<-0
}
y.lim<-c(y.min,y.max)
}
displacement<-y.lim[1]-((y.lim[2]-y.lim[1])/30)
plot(c(x.min,x.max),y.lim,xlim=c(x.min,x.max),
ylim=y.lim, col=pt.col,
bty="n",type="n",	axes=F, xlab="", ylab="")
for(i in 1:nrow(rect.xs)){
if(i%%2 == 0) {
rect.color<-"white"
} else {
rect.color<-"gray75"
}
rect(rect.xs[i,1],y.lim[1],rect.xs[i,2],y.lim[2],
col=rect.color, border=NA)
if(print.names==T){
text(x=mean(rect.xs[i,]),
y=displacement,labels=rownames(rect.xs)[i],
adj=1,xpd=T,srt=45)
}
}
for(i in 1:length(all.scaff)){
points(all.scaff[[i]][,bp.name],
all.scaff[[i]][,fst.name],
pch=19, cex=0.5,col=pt.col,
xlim=c(x.min,x.max),ylim=y.lim)
if(!is.null(ci.dat)){
temp.sig<-all.scaff[[i]][all.scaff[[i]][,fst.name] >= ci.dat[1],]
points(temp.sig[,bp.name], temp.sig[,fst.name],
col=sig.col[1], pch=19, cex=0.5)
temp.sig<-all.scaff[[i]][all.scaff[[i]][,fst.name] <= ci.dat[2],]
points(temp.sig[,bp.name], temp.sig[,fst.name],
col=sig.col[2], pch=19, cex=0.5)
}
}
if(axis.size>0){
axis(2, at = seq(round(y.lim[1],2),round(y.lim[2],2),
round((y.lim[2]-y.lim[1])/2, digits=2)),
ylim =y.lim, pos=0,
labels=seq(round(y.lim[1],2),round(y.lim[2],2),
round((y.lim[2]-y.lim[1])/2, digits=2)),
las=1,tck = -0.01, xlab="", ylab="", cex.axis=axis.size)
}
xes<-do.call("rbind",all.scaff)
return(xes)
}
fst.plot(fm.plot, fst.name="FEM.MAL",
chrom.name="Chrom", axis.size=0.75,bp.name="Pos",groups=scaffs)
warnings9)
warnings())
warnings()
fst.plot<-function(fst.dat,ci.dat=NULL, sig.col=c("red","yellow"),pt.col="grey7",
fst.name="Fst", chrom.name="Chrom", bp.name="BP",axis.size=0.5,
scaffold.order=NULL,groups=NULL,print.names=FALSE,y.lim=NULL,
group.boundaries=NULL){
if(!is.null(scaffold.order)){
scaff.ord<-scaffold.order$component_id
lgs<-scaffold.order$object
} else{
if(!is.null(group.boundaries)){
scaff.ord<-levels(factor(group.boundaries[,1]))
lgs<-scaff.ord
}else{
scaff.ord<-levels(factor(fst.dat[,chrom.name]))
lgs<-scaff.ord
}
}
if(!is.null(groups)){
lgs<-groups
scaff.ord<-groups
}
fst.dat[,fst.name]<-as.numeric(as.character(fst.dat[,fst.name]))
these.scaffs<-scaff.ord[scaff.ord %in% factor(fst.dat[,chrom.name])]
all.scaff<-split(fst.dat, factor(fst.dat[,chrom.name]))
group.boundaries<-group.boundaries[scaff.ord,]
last.max<-0
rect.xs<-NULL
addition.values<-0
xlist<-NULL
#set up the rectangles
for(i in 1:length(scaff.ord)){
if(is.null(group.boundaries)){
new.max<-last.max+nrow(all.scaff[[scaff.ord[i]]])
}else{
new.max<-as.numeric(group.boundaries[scaff.ord[i],2])+as.numeric(last.max)
}
rect.xs<-rbind(rect.xs,c(last.max, new.max))
rownames(rect.xs)[i]<-scaff.ord[i]
addition.values<-c(addition.values, new.max)
last.max<-new.max
}
rownames(rect.xs)<-scaff.ord
for(i in 1:length(all.scaff)){
if(is.null(group.boundaries)){
#then this is done by relative position only
all.scaff[[i]]<-all.scaff[[i]][order(all.scaff[[i]][,bp.name]),]
all.scaff[[i]][,bp.name]<-
seq(rect.xs[rownames(rect.xs) %in% names(all.scaff)[i],1]+1,rect.xs[rownames(rect.xs) %in% names(all.scaff)[i],1]+nrow(all.scaff[[i]]),1)
}else{
#then it takes genome space into account
all.scaff[[i]]<-
all.scaff[[i]][order(all.scaff[[i]][,bp.name]),]
all.scaff[[i]][,bp.name]<-
as.numeric(rect.xs[rownames(rect.xs) %in% names(all.scaff)[i],1])+as.numeric(all.scaff[[i]][,bp.name])
}
}
#change BP to plot
x.max<-max(rect.xs)
x.min<-min(rect.xs)
if(is.null(y.lim)){
y.max<-max(fst.dat[,fst.name])+0.1*max(fst.dat[,fst.name])
y.min<-min(fst.dat[,fst.name])-0.1*min(fst.dat[,fst.name])
if(min(fst.dat[,fst.name]) < 0) {
y.min<-min(fst.dat[,fst.name]) - 0.1*min(fst.dat[,fst.name])
} else {
y.min<-0
}
y.lim<-c(y.min,y.max)
}
displacement<-y.lim[1]-((y.lim[2]-y.lim[1])/30)
plot(c(x.min,x.max),y.lim,xlim=c(x.min,x.max),
ylim=y.lim, col=pt.col,
bty="n",type="n",	axes=F, xlab="", ylab="")
for(i in 1:nrow(rect.xs)){
if(i%%2 == 0) {
rect.color<-"white"
} else {
rect.color<-"gray75"
}
rect(rect.xs[i,1],y.lim[1],rect.xs[i,2],y.lim[2],
col=rect.color, border=NA)
if(print.names==T){
text(x=mean(rect.xs[i,]),
y=displacement,labels=rownames(rect.xs)[i],
adj=1,xpd=T,srt=45)
}
}
for(i in 1:length(all.scaff)){
points(all.scaff[[i]][,bp.name],
all.scaff[[i]][,fst.name],
pch=19, cex=0.5,col=pt.col,
xlim=c(x.min,x.max),ylim=y.lim)
if(!is.null(ci.dat)){
temp.sig<-all.scaff[[i]][all.scaff[[i]][,fst.name] >= ci.dat[1],]
points(temp.sig[,bp.name], temp.sig[,fst.name],
col=sig.col[1], pch=19, cex=0.5)
temp.sig<-all.scaff[[i]][all.scaff[[i]][,fst.name] <= ci.dat[2],]
points(temp.sig[,bp.name], temp.sig[,fst.name],
col=sig.col[2], pch=19, cex=0.5)
}
}
if(axis.size>0){
axis(2, at = seq(round(y.lim[1],2),round(y.lim[2],2),
round((y.lim[2]-y.lim[1])/2, digits=2)),
ylim =y.lim, pos=0,
labels=seq(round(y.lim[1],2),round(y.lim[2],2),
round((y.lim[2]-y.lim[1])/2, digits=2)),
las=1,tck = -0.01, xlab="", ylab="", cex.axis=axis.size)
}
xes<-do.call("rbind",all.scaff)
return(xes)
}
<<<<<<< HEAD
fst.plot(fm.plot, fst.name="FEM.MAL",
chrom.name="Chrom", axis.size=0.75,bp.name="Pos",groups=scaffs)
fst.plot(fm.plot, fst.name="FEM.MAL",
chrom.name="Chrom", axis.size=0.75,bp.name="Pos",groups=scaffs[scaffs %in% factor(fm.plot$Chrom)])
setwd("~/Projects/gwscaR/")
dev.off()
?vcf.alleles
library(devtools)
library(roxygen2)
source('~/Projects/gwscaR/R/gwscaR.R')
source('~/Projects/gwscaR/R/gwscaR.R')
=======
mo<-fst.plot(mo.plot, ci.dat=c(mo.top1,0),fst.name="MOM.FEM",
chrom.name="Chrom", axis.size=0,bp.name="Pos",print.names = T,
sig.col=c("black","black"),groups=as.factor(scaffs),group.boundaries = max.pos)
max(keep.vcf[keep.vcf$`#CHROM`=="LG10","POS"])
max(mo.plot[mo.plot$Chrom=="LG10","Pos"])
source('~/GitHub/gwscaR/R/gwscaR.R')
>>>>>>> 4a7fa21eb973fcda977437fb1c379d3f15e0522d
